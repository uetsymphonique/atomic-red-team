{
  "attack_technique": "T1564.001",
  "display_name": "Hide Artifacts: Hidden Files and Directories",
  "atomic_tests": [
    {
      "name": "Create a hidden file in a hidden directory",
      "description": "Creates a hidden file inside a hidden directory",
      "supported_platforms": [
        "linux",
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "command": "mkdir /var/tmp/.hidden-directory\necho \"T1564.001\" > /var/tmp/.hidden-directory/.hidden-file",
        "cleanup_command": "rm -rf /var/tmp/.hidden-directory/"
      },
      "input_arguments": {},
      "auto_generated_guid": "61a782e5-9a19-40b5-8ba4-69a4b9f3d7be"
    },
    {
      "name": "Mac Hidden file",
      "description": "Hide a file on MacOS",
      "supported_platforms": [
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "command": "xattr -lr * / 2>&1 /dev/null | grep -C 2 \"00 00 00 00 00 00 00 00 40 00 FF FF FF FF 00 00\""
      },
      "input_arguments": {},
      "auto_generated_guid": "cddb9098-3b47-4e01-9d3b-6f5f323288a9"
    },
    {
      "name": "Create Windows System File with Attrib",
      "description": "Creates a file and marks it as a system file using the attrib.exe utility. Upon execution, open the file in file explorer then open Properties > Details\nand observe that the Attributes are \"SA\" for System and Archive.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "command": "attrib.exe +s #{file_to_modify}",
        "cleanup_command": "del /A:S #{file_to_modify} >nul 2>&1"
      },
      "input_arguments": {
        "file_to_modify": {
          "description": "File to modify using Attrib command",
          "type": "string",
          "default": "%temp%\\T1564.001.txt"
        }
      },
      "dependencies": [
        {
          "description": "The file must exist on disk at specified location (#{file_to_modify})",
          "prereq_command": "IF EXIST #{file_to_modify} ( EXIT 0 ) ELSE ( EXIT 1 )",
          "get_prereq_command": "echo system_Attrib_T1564.001 >> #{file_to_modify}"
        }
      ],
      "auto_generated_guid": "f70974c8-c094-4574-b542-2c545af95a32"
    },
    {
      "name": "Create Windows Hidden File with Attrib",
      "description": "Creates a file and marks it as hidden using the attrib.exe utility.Upon execution, open File Epxplorer and enable View > Hidden Items. Then, open Properties > Details on the file\nand observe that the Attributes are \"SH\" for System and Hidden.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "command": "attrib.exe +h #{file_to_modify}",
        "cleanup_command": "del /A:H #{file_to_modify} >nul 2>&1"
      },
      "input_arguments": {
        "file_to_modify": {
          "description": "File to modify using Attrib command",
          "type": "string",
          "default": "%temp%\\T1564.001.txt"
        }
      },
      "dependencies": [
        {
          "description": "The file must exist on disk at specified location (#{file_to_modify})",
          "prereq_command": "IF EXIST #{file_to_modify} ( EXIT 0 ) ELSE ( EXIT 1 )",
          "get_prereq_command": "echo system_Attrib_T1564.001 >> #{file_to_modify}"
        }
      ],
      "auto_generated_guid": "dadb792e-4358-4d8d-9207-b771faa0daa5"
    },
    {
      "name": "Hidden files",
      "description": "Requires Apple Dev Tools",
      "supported_platforms": [
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "command": "setfile -a V #{filename}"
      },
      "input_arguments": {
        "filename": {
          "description": "path of file to hide",
          "type": "path",
          "default": "/tmp/evil"
        }
      },
      "auto_generated_guid": "3b7015f2-3144-4205-b799-b05580621379"
    },
    {
      "name": "Hide a Directory",
      "description": "Hide a directory on MacOS",
      "supported_platforms": [
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "command": "touch /var/tmp/T1564.001_mac.txt\nchflags hidden /var/tmp/T1564.001_mac.txt",
        "cleanup_command": "rm /var/tmp/T1564.001_mac.txt"
      },
      "input_arguments": {},
      "auto_generated_guid": "b115ecaf-3b24-4ed2-aefe-2fcb9db913d3"
    },
    {
      "name": "Show all hidden files",
      "description": "Show all hidden files on MacOS",
      "supported_platforms": [
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "command": "defaults write com.apple.finder AppleShowAllFiles YES",
        "cleanup_command": "defaults write com.apple.finder AppleShowAllFiles NO"
      },
      "input_arguments": {},
      "auto_generated_guid": "9a1ec7da-b892-449f-ad68-67066d04380c"
    },
    {
      "name": "Hide Files Through Registry",
      "description": "Disable Show Hidden files switch in registry. This technique was abused by several malware to hide their files from normal user.\nSee how this trojan abuses this technique - https://www.sophos.com/en-us/threat-center/threat-analyses/viruses-and-spyware/W32~Tiotua-P/detailed-analysis.aspx",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "command": "reg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /v ShowSuperHidden /t REG_DWORD /d 0 /f\nreg add HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced /v Hidden /t REG_DWORD /d 0 /f",
        "cleanup_command": "reg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\" /v ShowSuperHidden /f >nul 2>&1\nreg delete \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Explorer\\Advanced\" /v Hidden /f >nul 2>&1"
      },
      "input_arguments": {},
      "auto_generated_guid": "f650456b-bd49-4bc1-ae9d-271b5b9581e7"
    },
    {
      "name": "Create Windows Hidden File with powershell",
      "description": "Creates a file and marks it as hidden through powershell. Upon execution, open File Epxplorer and enable View > Hidden Items. Then, open Properties > Details on the file\nand observe that the Attributes is \"H\" Hidden.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "command": "$file = Get-Item $env:temp\\T1564.001-9.txt -Force\n$file.attributes='Hidden'",
        "cleanup_command": "cmd /c 'del /A:H #{file_to_modify} >nul 2>&1'"
      },
      "input_arguments": {
        "file_to_modify": {
          "description": "File to modify",
          "type": "string",
          "default": "%temp%\\T1564.001-9.txt"
        }
      },
      "dependencies": [
        {
          "description": "The file must exist on disk at specified location (#{file_to_modify})",
          "prereq_command": "IF EXIST #{file_to_modify} ( EXIT 0 ) ELSE ( EXIT 1 )",
          "get_prereq_command": "echo system_Attrib_T1564.001-9 >> #{file_to_modify}"
        }
      ],
      "dependency_executor_name": "command_prompt",
      "auto_generated_guid": "7f66d539-4fbe-4cfa-9a56-4a2bf660c58a"
    },
    {
      "name": "Create Windows System File with powershell",
      "description": "Creates a file and marks it as System through powershell. Upon execution, open File Epxplorer and enable View > Hidden Items. Then, open Properties > Details on the file\nand observe that the Attributes is \"S\" System.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "command": "$file = Get-Item $env:temp\\T1564.001-10.txt -Force\n$file.attributes='System'",
        "cleanup_command": "cmd /c 'del /A:H #{file_to_modify} >nul 2>&1'"
      },
      "input_arguments": {
        "file_to_modify": {
          "description": "File to modify",
          "type": "string",
          "default": "%temp%\\T1564.001-10.txt"
        }
      },
      "dependencies": [
        {
          "description": "The file must exist on disk at specified location (#{file_to_modify})",
          "prereq_command": "IF EXIST #{file_to_modify} ( EXIT 0 ) ELSE ( EXIT 1 )",
          "get_prereq_command": "echo system_Attrib_T1564.001-10 >> #{file_to_modify}"
        }
      ],
      "dependency_executor_name": "command_prompt",
      "auto_generated_guid": "d380c318-0b34-45cb-9dad-828c11891e43"
    }
  ]
}