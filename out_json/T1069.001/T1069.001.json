{
  "attack_technique": "T1069.001",
  "display_name": "Permission Groups Discovery: Local Groups",
  "atomic_tests": [
    {
      "name": "Permission Groups Discovery (Local)",
      "description": "Permission Groups Discovery",
      "supported_platforms": [
        "linux",
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "command": "if [ -x \"$(command -v dscacheutil)\" ]; then dscacheutil -q group; else echo \"dscacheutil is missing from the machine. skipping...\"; fi;\nif [ -x \"$(command -v dscl)\" ]; then dscl . -list /Groups; else echo \"dscl is missing from the machine. skipping...\"; fi;\nif [ -x \"$(command -v groups)\" ]; then groups; else echo \"groups is missing from the machine. skipping...\"; fi;\nif [ -x \"$(command -v id)\" ]; then id; else echo \"id is missing from the machine. skipping...\"; fi;\nif [ -x \"$(command -v getent)\" ]; then getent group; else echo \"getent is missing from the machine. skipping...\"; fi;\ncat /etc/group"
      },
      "input_arguments": {},
      "auto_generated_guid": "952931a4-af0b-4335-bbbe-73c8c5b327ae"
    },
    {
      "name": "Basic Permission Groups Discovery Windows (Local)",
      "description": "Basic Permission Groups Discovery for Windows. This test will display some errors if run on a computer not connected to a domain. Upon execution, domain\ninformation will be displayed.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": false,
        "command": "net localgroup\nnet localgroup \"Administrators\""
      },
      "input_arguments": {},
      "auto_generated_guid": "1f454dd6-e134-44df-bebb-67de70fb6cd8"
    },
    {
      "name": "Permission Groups Discovery PowerShell (Local)",
      "description": "Permission Groups Discovery utilizing PowerShell. This test will display some errors if run on a computer not connected to a domain. Upon execution, domain\ninformation will be displayed.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "command": "get-localgroup\nGet-LocalGroupMember -Name \"Administrators\""
      },
      "input_arguments": {},
      "auto_generated_guid": "a580462d-2c19-4bc7-8b9a-57a41b7d3ba4"
    },
    {
      "name": "SharpHound3 - LocalAdmin",
      "description": "This module runs the Windows executable of SharpHound in order to remotely list members of the local Administrators group (SAMR)",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "command": "New-Item -Path \"#{output_path}\" -ItemType Directory > $null\n& \"#{sharphound_path}\" -d \"#{domain}\" --CollectionMethod LocalAdmin --NoSaveCache --OutputDirectory \"#{output_path}\"",
        "cleanup_command": "Remove-Item -Recurse #{output_path} -ErrorAction Ignore"
      },
      "input_arguments": {
        "domain": {
          "description": "FQDN of the targeted domain",
          "type": "string",
          "default": "$env:UserDnsDomain"
        },
        "sharphound_path": {
          "description": "SharpHound Windows executable",
          "type": "path",
          "default": "PathToAtomicsFolder\\..\\ExternalPayloads\\SharpHound.exe"
        },
        "output_path": {
          "description": "Output for SharpHound",
          "type": "path",
          "default": "$env:TEMP\\SharpHound\\"
        }
      },
      "dependencies": [
        {
          "description": "SharpHound binary must exist on disk and at specified location (#{sharphound_path}).",
          "prereq_command": "if (Test-Path \"#{sharphound_path}\") { exit 0 } else { exit 1 }",
          "get_prereq_command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/BloodHoundAD/BloodHound/blob/e062fe73d73c015dccb37fae5089342d009b84b8/Collectors/SharpHound.exe?raw=true\" -OutFile \"#{sharphound_path}\""
        }
      ],
      "auto_generated_guid": "e03ada14-0980-4107-aff1-7783b2b59bb1"
    },
    {
      "name": "Wmic Group Discovery",
      "description": "Utilizing wmic.exe to enumerate groups on the local system. Upon execution, information will be displayed of local groups on system.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": false,
        "command": "wmic group get name"
      },
      "input_arguments": {},
      "auto_generated_guid": "7413be50-be8e-430f-ad4d-07bf197884b2"
    },
    {
      "name": "WMIObject Group Discovery",
      "description": "Utilizing PowerShell cmdlet - get-wmiobject, to enumerate local groups on the endpoint. Upon execution, Upon execution, information will be displayed of local groups on system.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "command": "Get-WMIObject Win32_Group"
      },
      "input_arguments": {},
      "auto_generated_guid": "69119e58-96db-4110-ad27-954e48f3bb13"
    },
    {
      "name": "Permission Groups Discovery for Containers- Local Groups",
      "description": "Attackers may try to obtain a list of services that are operating on remote hosts and local network infrastructure devices, in order to identify potential vulnerabilities that can be exploited through remote software attacks. They typically use tools to conduct port and vulnerability scans in order to obtain this information.",
      "supported_platforms": [
        "containers"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "command": "docker build -t t1069 $PathtoAtomicsFolder/T1069.001/src/\ndocker run --name t1069_container --rm -d -t t1069\ndocker exec t1069_container ./test.sh",
        "cleanup_command": "docker stop t1069_container\ndocker rmi -f t1069"
      },
      "input_arguments": {},
      "dependencies": [
        {
          "description": "Verify docker is installed.",
          "prereq_command": "which docker",
          "get_prereq_command": "if [ \"\" == \"`which docker`\" ]; then echo \"Docker Not Found\"; if [ -n \"`which apt-get`\" ]; then sudo apt-get -y install docker ; elif [ -n \"`which yum`\" ]; then sudo yum -y install docker ; fi ; else echo \"Docker installed\"; fi"
        },
        {
          "description": "Verify docker service is running.",
          "prereq_command": "sudo systemctl status docker  --no-pager",
          "get_prereq_command": "sudo systemctl start docker"
        }
      ],
      "auto_generated_guid": "007d7aa4-8c4d-4f55-ba6a-7c965d51219c"
    }
  ]
}