{
  "attack_technique": "T1136.002",
  "display_name": "Create Account: Domain Account",
  "atomic_tests": [
    {
      "name": "Create a new Windows domain admin user",
      "description": "Creates a new domain admin user in a command prompt.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": false,
        "command": "net user \"#{username}\" \"#{password}\" /add /domain\nnet group \"#{group}\" \"#{username}\" /add /domain",
        "cleanup_command": "net user \"#{username}\" >nul 2>&1 /del /domain"
      },
      "input_arguments": {
        "username": {
          "description": "Username of the user to create",
          "type": "string",
          "default": "T1136.002_Admin"
        },
        "password": {
          "description": "Password of the user to create",
          "type": "string",
          "default": "T1136_pass123!"
        },
        "group": {
          "description": "Domain administrator group to which add the user to",
          "type": "string",
          "default": "Domain Admins"
        }
      },
      "auto_generated_guid": "fcec2963-9951-4173-9bfa-98d8b7834e62"
    },
    {
      "name": "Create a new account similar to ANONYMOUS LOGON",
      "description": "Create a new account similar to ANONYMOUS LOGON in a command prompt.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": false,
        "command": "net user \"#{username}\" \"#{password}\" /add /domain",
        "cleanup_command": "net user \"#{username}\" >nul 2>&1 /del /domain"
      },
      "input_arguments": {
        "username": {
          "description": "Username of the user to create",
          "type": "string",
          "default": "ANONYMOUS  LOGON"
        },
        "password": {
          "description": "Password of the user to create",
          "type": "string",
          "default": "T1136_pass123!"
        }
      },
      "auto_generated_guid": "dc7726d2-8ccb-4cc6-af22-0d5afb53a548"
    },
    {
      "name": "Create a new Domain Account using PowerShell",
      "description": "Creates a new Domain User using the credentials of the Current User",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "command": "$SamAccountName = '#{username}'\n$AccountPassword = ConvertTo-SecureString '#{password}' -AsPlainText -Force\nAdd-Type -AssemblyName System.DirectoryServices.AccountManagement\n$Context = New-Object -TypeName System.DirectoryServices.AccountManagement.PrincipalContext -ArgumentList ([System.DirectoryServices.AccountManagement.ContextType]::Domain)\n$User = New-Object -TypeName System.DirectoryServices.AccountManagement.UserPrincipal -ArgumentList ($Context)\n$User.SamAccountName = $SamAccountName\n$TempCred = New-Object System.Management.Automation.PSCredential('a', $AccountPassword)\n$User.SetPassword($TempCred.GetNetworkCredential().Password)\n$User.Enabled = $True\n$User.PasswordNotRequired = $False\n$User.DisplayName = $SamAccountName\n$User.Save()\n$User",
        "cleanup_command": "cmd /c \"net user #{username} /del >nul 2>&1\""
      },
      "input_arguments": {
        "username": {
          "description": "Name of the Account to be created",
          "type": "string",
          "default": "T1136.002_Admin"
        },
        "password": {
          "description": "Password of the Account to be created",
          "type": "string",
          "default": "T1136_pass123!"
        }
      },
      "auto_generated_guid": "5a3497a4-1568-4663-b12a-d4a5ed70c7d7"
    },
    {
      "name": "Active Directory Create Admin Account",
      "description": "Use Admin Credentials to Create A Domain Admin Account",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "command": "echo \"dn: CN=Admin User,CN=Users,DC=#{domain},DC=#{top_level_domain}\\nchangetype: add\\nobjectClass: top\\nobjectClass: person\\nobjectClass: organizationalPerson\\nobjectClass: user\\ncn: Admin User\\nsn: User\\ngivenName: Atomic User\\nuserPrincipalName: adminuser@#{domain}.#{top_level_domain}\\nsAMAccountName: adminuser\\nuserAccountControl: 512\\nuserPassword: {CLEARTEXT}s3CureP4ssword123!\\nmemberOf: CN=Domain Admins,CN=Users,DC=#{domain},DC=#{top_level_domain}\" > tempadmin.ldif\necho ldapadd -H ldap://#{domain}.#{top_level_domain}:389 -x -D #{admin_user} -w #{admin_password} -f tempadmin.ldif\nldapadd -H ldap://#{domain}.#{top_level_domain}:389 -x -D #{admin_user} -w #{admin_password} -f tempadmin.ldif",
        "cleanup_command": "echo removing Atomic User (temporary user)\necho \"dn: cn=Atomic User,cn=Users,dc=scwxscratch,dc=dev\\nchangetype: delete\" > deleteuser.ldif\nldapmodify -H ldap://#{domain_controller}:389 -x -D #{admin_user} -w #{admin_password} -f deleteuser.ldif\nrm deleteuser.ldif\nrm tempadmin.ldif"
      },
      "input_arguments": {
        "domain": {
          "description": "The domain to be tested",
          "type": "string",
          "default": "example"
        },
        "top_level_domain": {
          "description": "The top level domain (.com, .test, .remote, etc... following domain, minus the .)",
          "type": "string",
          "default": "test"
        },
        "admin_user": {
          "description": "username@domain of a user with admin privileges",
          "type": "string",
          "default": "admin@example.test"
        },
        "admin_password": {
          "description": "password of the user with admin privileges referenced in admin_user",
          "type": "string",
          "default": "s3CurePssw0rD!"
        },
        "domain_controller": {
          "description": "Name of the domain_controller machine, defined in etc/hosts",
          "type": "string",
          "default": "adVM"
        }
      },
      "dependencies": [
        {
          "description": "Packages sssd-ad sssd-tools realmd adcli installed and realm available",
          "prereq_command": "which ldapadd && which ldapmodify",
          "get_prereq_command": "echo ldapadd or ldapmodify not found; exit 1"
        }
      ],
      "auto_generated_guid": "562aa072-524e-459a-ba2b-91f1afccf5ab"
    },
    {
      "name": "Active Directory Create User Account (Non-elevated)",
      "description": "Use Admin Credentials to Create A Normal Account (as means of entry)",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "command": "echo \"dn: cn=Atomic User, cn=Users,dc=#{domain},dc=#{top_level_domain}\\nobjectClass: person\\ncn: Atomic User\\nsn: User\" > tempadmin.ldif\necho ldapadd -H ldap://#{domain}.#{top_level_domain}:389 -x -D #{admin_user} -w #{admin_password} -f tempadmin.ldif\nldapadd -H ldap://#{domain}.#{top_level_domain}:389 -x -D #{admin_user} -w #{admin_password} -f tempadmin.ldif",
        "cleanup_command": "echo removing Atomic User (temporary user)\necho \"dn: cn=Atomic User,cn=Users,dc=scwxscratch,dc=dev\\nchangetype: delete\" > deleteuser.ldif\nldapmodify -H ldap://#{domain_controller}:389 -x -D #{admin_user} -w #{admin_password} -f deleteuser.ldif\nrm deleteuser.ldif\nrm tempadmin.ldif"
      },
      "input_arguments": {
        "domain": {
          "description": "The domain to be tested",
          "type": "string",
          "default": "example"
        },
        "top_level_domain": {
          "description": "The top level domain (.com, .test, .remote, etc... following domain, minus the .)",
          "type": "string",
          "default": "test"
        },
        "admin_user": {
          "description": "username@domain of a user with admin privileges",
          "type": "string",
          "default": "user@example.test"
        },
        "admin_password": {
          "description": "password of the user",
          "type": "string",
          "default": "s3CurePssw0rD!"
        },
        "domain_controller": {
          "description": "Name of the domain_controller machine, defined in etc/hosts",
          "type": "string",
          "default": "adVM"
        }
      },
      "dependencies": [
        {
          "description": "Packages sssd-ad sssd-tools realmd adcli installed and realm available, ldapadd, ldapmodify",
          "prereq_command": "which ldapadd\nwhich ldapmodify",
          "get_prereq_command": "echo ldapadd or ldapmodify not found; exit 1"
        }
      ],
      "auto_generated_guid": "8c992cb3-a46e-4fd5-b005-b1bab185af31"
    }
  ]
}