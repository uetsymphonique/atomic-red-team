{
  "attack_technique": "T1053.002",
  "display_name": "Scheduled Task/Job: At",
  "atomic_tests": [
    {
      "name": "At.exe Scheduled task",
      "description": "Executes cmd.exe\nNote: deprecated in Windows 8+\n\nUpon successful execution, cmd.exe will spawn at.exe and create a scheduled task that will spawn cmd at a specific time.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": false,
        "procedure": "at 13:20 /interactive cmd"
      },
      "input_arguments": [],
      "auto_generated_guid": "4a6c0dc4-0f2a-4203-9298-a5a9bdc21ed8"
    },
    {
      "name": "At - Schedule a job",
      "description": "This test submits a command to be run in the future by the `at` daemon.",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "procedure": "echo \"#{at_command}\" | at #{time_spec}"
      },
      "input_arguments": [
        {
          "arg_name": "time_spec",
          "description": "Time specification of when the command should run",
          "type": "string",
          "default": "now + 1 minute"
        },
        {
          "arg_name": "at_command",
          "description": "The command to be run",
          "type": "string",
          "default": "echo Hello from Atomic Red Team"
        }
      ],
      "dependencies": [
        {
          "description": "The `at` and `atd` executables must exist in the PATH",
          "prereq_command": "if [ \"$(uname)\" = 'FreeBSD' ]; then which at; else which at && which atd; fi;",
          "get_prereq_command": "echo 'Please install `at` and `atd`; they were not found in the PATH (Package name: `at`)'"
        },
        {
          "description": "The `atd` daemon must be running",
          "prereq_command": "if [ $(uname) = 'Linux' ]; then systemctl status atd || service atd status; fi;",
          "get_prereq_command": "echo 'Please start the `atd` daemon (sysv: `service atd start` ; systemd: `systemctl start atd`)'"
        }
      ],
      "auto_generated_guid": "7266d898-ac82-4ec0-97c7-436075d0d08e"
    },
    {
      "name": "At - Schedule a job via kubectl in a Pod",
      "description": "Launches a short-lived Ubuntu pod, installs the `at` utility, starts the `atd` daemon,\nand submits a job with `at`. The pod is deleted after execution.",
      "supported_platforms": [
        "containers"
      ],
      "executor": {
        "name": "bash",
        "elevation_required": false,
        "procedure": "kubectl run #{pod_name} --image=#{image_name} --restart=Never --attach --rm -i -- bash -lc \"apt-get update -y >/dev/null 2>&1 && apt-get install -y at >/dev/null 2>&1 && (atd || /usr/sbin/atd) && echo '#{at_command}' | at #{time_spec} && at -l\""
      },
      "input_arguments": [
        {
          "arg_name": "image_name",
          "description": "Name of the image",
          "type": "string",
          "default": "ubuntu"
        },
        {
          "arg_name": "pod_name",
          "description": "K8s pod name to execute the command in",
          "type": "string",
          "default": "atomic-at-schedule"
        },
        {
          "arg_name": "time_spec",
          "description": "Time specification of when the command should run",
          "type": "string",
          "default": "now + 1 minute"
        },
        {
          "arg_name": "at_command",
          "description": "The command to be run",
          "type": "string",
          "default": "echo Hello from Atomic Red Team"
        }
      ],
      "dependencies": [
        {
          "description": "kubectl must be installed and configured",
          "prereq_command": "which kubectl",
          "get_prereq_command": "echo \"kubectl must be installed manually\""
        }
      ],
      "auto_generated_guid": "9ddf2e5e-7e2c-46c2-9940-3c2ff29c7213"
    }
  ]
}