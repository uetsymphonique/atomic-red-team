{
  "attack_technique": "T1218.004",
  "display_name": "Signed Binary Proxy Execution: InstallUtil",
  "atomic_tests": [
    {
      "name": "CheckIfInstallable method call",
      "description": "Executes the CheckIfInstallable class constructor runner instead of executing InstallUtil. Upon execution, the InstallUtil test harness will be executed.\nIf no output is displayed the test executed successfuly.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "cleanup_command": "$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\nRemove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore",
        "procedure": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$ExpectedOutput = 'Constructor_'\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = '#{invocation_method}'\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nCheckIfInstallable method execution test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}"
      },
      "input_arguments": [
        {
          "arg_name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default": "PathToAtomicsFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        },
        {
          "arg_name": "assembly_dir",
          "description": "directory to drop the compiled installer assembly",
          "type": "path",
          "default": "$Env:TEMP\\"
        },
        {
          "arg_name": "invocation_method",
          "description": "the type of InstallUtil invocation variant - Executable, InstallHelper, or CheckIfInstallable",
          "type": "string",
          "default": "CheckIfInstallable"
        },
        {
          "arg_name": "assembly_filename",
          "description": "filename of the compiled installer assembly",
          "type": "string",
          "default": "T1218.004.dll"
        }
      ],
      "dependencies": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})",
          "prereq_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}",
          "get_prereq_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\""
        }
      ],
      "auto_generated_guid": "ffd9c807-d402-47d2-879d-f915cf2a3a94"
    },
    {
      "name": "InstallHelper method call",
      "description": "Executes the InstallHelper class constructor runner instead of executing InstallUtil. Upon execution, no output will be displayed if the test\nexecuted successfuly.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "cleanup_command": "$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\nRemove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore",
        "procedure": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$CommandLine = \"/logfile= /logtoconsole=false `\"$InstallerAssemblyFullPath`\"\"\n$ExpectedOutput = 'Constructor_'\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = '#{invocation_method}'\n    CommandLine = $CommandLine\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nInstallHelper method execution test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}"
      },
      "input_arguments": [
        {
          "arg_name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default": "PathToAtomicsFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        },
        {
          "arg_name": "assembly_dir",
          "description": "directory to drop the compiled installer assembly",
          "type": "path",
          "default": "$Env:TEMP\\"
        },
        {
          "arg_name": "invocation_method",
          "description": "the type of InstallUtil invocation variant - Executable, InstallHelper, or CheckIfInstallable",
          "type": "string",
          "default": "InstallHelper"
        },
        {
          "arg_name": "assembly_filename",
          "description": "filename of the compiled installer assembly",
          "type": "string",
          "default": "T1218.004.dll"
        }
      ],
      "dependencies": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})",
          "prereq_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}",
          "get_prereq_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\""
        }
      ],
      "auto_generated_guid": "d43a5bde-ae28-4c55-a850-3f4c80573503"
    },
    {
      "name": "InstallUtil class constructor method call",
      "description": "Executes the installer assembly class constructor. Upon execution, version information will be displayed the .NET framework install utility.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "cleanup_command": "$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\nRemove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore",
        "procedure": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$CommandLine = \"/logfile= /logtoconsole=false `\"$InstallerAssemblyFullPath`\"\"\n$ExpectedOutput = 'Constructor_'\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = '#{invocation_method}'\n    CommandLine = $CommandLine\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nInstallUtil class constructor execution test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}"
      },
      "input_arguments": [
        {
          "arg_name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default": "PathToAtomicsFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        },
        {
          "arg_name": "assembly_dir",
          "description": "directory to drop the compiled installer assembly",
          "type": "path",
          "default": "$Env:TEMP\\"
        },
        {
          "arg_name": "invocation_method",
          "description": "the type of InstallUtil invocation variant - Executable, InstallHelper, or CheckIfInstallable",
          "type": "string",
          "default": "Executable"
        },
        {
          "arg_name": "assembly_filename",
          "description": "filename of the compiled installer assembly",
          "type": "string",
          "default": "T1218.004.dll"
        }
      ],
      "dependencies": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})",
          "prereq_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}",
          "get_prereq_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\""
        }
      ],
      "auto_generated_guid": "9b7a7cfc-dd2e-43f5-a885-c0a3c270dd93"
    },
    {
      "name": "InstallUtil Install method call",
      "description": "Executes the Install Method. Upon execution, version information will be displayed the .NET framework install utility.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "cleanup_command": "$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\nRemove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore",
        "procedure": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$CommandLine = \"/logfile= /logtoconsole=false /installtype=notransaction /action=install `\"$InstallerAssemblyFullPath`\"\"\n$ExpectedOutput = 'Constructor_Install_'\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = '#{invocation_method}'\n    CommandLine = $CommandLine\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nInstallUtil Install method execution test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}"
      },
      "input_arguments": [
        {
          "arg_name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default": "PathToAtomicsFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        },
        {
          "arg_name": "assembly_dir",
          "description": "directory to drop the compiled installer assembly",
          "type": "path",
          "default": "$Env:TEMP\\"
        },
        {
          "arg_name": "invocation_method",
          "description": "the type of InstallUtil invocation variant - Executable, InstallHelper, or CheckIfInstallable",
          "type": "string",
          "default": "Executable"
        },
        {
          "arg_name": "assembly_filename",
          "description": "filename of the compiled installer assembly",
          "type": "string",
          "default": "T1218.004.dll"
        }
      ],
      "dependencies": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})",
          "prereq_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}",
          "get_prereq_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\""
        }
      ],
      "auto_generated_guid": "9f9968a6-601a-46ca-b7b7-6d4fe0f98f0b"
    },
    {
      "name": "InstallUtil Uninstall method call - /U variant",
      "description": "Executes the Uninstall Method. Upon execution, version information will be displayed the .NET framework install utility.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "cleanup_command": "$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\nRemove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore",
        "procedure": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$CommandLine = \"/logfile= /logtoconsole=false /U `\"$InstallerAssemblyFullPath`\"\"\n$ExpectedOutput = 'Constructor_Uninstall_'\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = '#{invocation_method}'\n    CommandLine = $CommandLine\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nInstallUtil Uninstall method execution test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}"
      },
      "input_arguments": [
        {
          "arg_name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default": "PathToAtomicsFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        },
        {
          "arg_name": "assembly_dir",
          "description": "directory to drop the compiled installer assembly",
          "type": "path",
          "default": "$Env:TEMP\\"
        },
        {
          "arg_name": "invocation_method",
          "description": "the type of InstallUtil invocation variant - Executable, InstallHelper, or CheckIfInstallable",
          "type": "string",
          "default": "Executable"
        },
        {
          "arg_name": "assembly_filename",
          "description": "filename of the compiled installer assembly",
          "type": "string",
          "default": "T1218.004.dll"
        }
      ],
      "dependencies": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})",
          "prereq_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}",
          "get_prereq_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\""
        }
      ],
      "auto_generated_guid": "34428cfa-8e38-41e5-aff4-9e1f8f3a7b4b"
    },
    {
      "name": "InstallUtil Uninstall method call - '/installtype=notransaction /action=uninstall' variant",
      "description": "Executes the Uninstall Method. Upon execution, version information will be displayed the .NET framework install utility.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "cleanup_command": "$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\nRemove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore",
        "procedure": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$CommandLine = \"/logfile= /logtoconsole=false /installtype=notransaction /action=uninstall `\"$InstallerAssemblyFullPath`\"\"\n$ExpectedOutput = 'Constructor_Uninstall_'\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = '#{invocation_method}'\n    CommandLine = $CommandLine\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nInstallUtil Uninstall method execution test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}"
      },
      "input_arguments": [
        {
          "arg_name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default": "PathToAtomicsFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        },
        {
          "arg_name": "assembly_dir",
          "description": "directory to drop the compiled installer assembly",
          "type": "path",
          "default": "$Env:TEMP\\"
        },
        {
          "arg_name": "invocation_method",
          "description": "the type of InstallUtil invocation variant - Executable, InstallHelper, or CheckIfInstallable",
          "type": "string",
          "default": "Executable"
        },
        {
          "arg_name": "assembly_filename",
          "description": "filename of the compiled installer assembly",
          "type": "string",
          "default": "T1218.004.dll"
        }
      ],
      "dependencies": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})",
          "prereq_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}",
          "get_prereq_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\""
        }
      ],
      "auto_generated_guid": "06d9deba-f732-48a8-af8e-bdd6e4d98c1d"
    },
    {
      "name": "InstallUtil HelpText method call",
      "description": "Executes the Uninstall Method. Upon execution, help information will be displayed for InstallUtil.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "cleanup_command": "$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\nRemove-Item -Path $InstallerAssemblyFullPath -ErrorAction Ignore",
        "procedure": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"#{assembly_dir}\"\n$InstallerAssemblyFileName = \"#{assembly_filename}\"\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$CommandLine = \"/? `\"$InstallerAssemblyFullPath`\"\"\n$ExpectedOutput = 'Constructor_HelpText_'\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = '#{invocation_method}'\n    CommandLine = $CommandLine\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nInstallUtil HelpText property execution test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}"
      },
      "input_arguments": [
        {
          "arg_name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default": "PathToAtomicsFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        },
        {
          "arg_name": "assembly_dir",
          "description": "directory to drop the compiled installer assembly",
          "type": "path",
          "default": "$Env:TEMP\\"
        },
        {
          "arg_name": "invocation_method",
          "description": "the type of InstallUtil invocation variant - Executable, InstallHelper, or CheckIfInstallable",
          "type": "string",
          "default": "Executable"
        },
        {
          "arg_name": "assembly_filename",
          "description": "filename of the compiled installer assembly",
          "type": "string",
          "default": "T1218.004.dll"
        }
      ],
      "dependencies": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})",
          "prereq_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}",
          "get_prereq_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\""
        }
      ],
      "auto_generated_guid": "5a683850-1145-4326-a0e5-e91ced3c6022"
    },
    {
      "name": "InstallUtil evasive invocation",
      "description": "Executes an InstallUtil assembly by renaming InstallUtil.exe and using a nonstandard extension for the assembly. Upon execution, \"Running a transacted installation.\"\nwill be displayed, along with other information about the opperation. \"The transacted install has completed.\" will be displayed upon completion.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "cleanup_command": "Remove-Item -Path \"$Env:windir\\System32\\Tasks\\readme.txt\" -ErrorAction Ignore\nRemove-Item -Path \"$Env:windir\\System32\\Tasks\\readme.InstallLog\" -ErrorAction Ignore\nRemove-Item -Path \"$Env:windir\\System32\\Tasks\\readme.InstallState\" -ErrorAction Ignore\nRemove-Item -Path \"$Env:windir\\System32\\Tasks\\notepad.exe\" -ErrorAction Ignore",
        "procedure": "# Import the required test harness function, Invoke-BuildAndInvokeInstallUtilAssembly\n. \"#{test_harness}\"\n\n$InstallerAssemblyDir = \"$Env:windir\\System32\\Tasks\"\n$InstallerAssemblyFileName = 'readme.txt'\n$InstallerAssemblyFullPath = Join-Path -Path $InstallerAssemblyDir -ChildPath $InstallerAssemblyFileName\n\n$CommandLine = \"readme.txt\"\n$ExpectedOutput = 'Constructor_'\n\n# Explicitly set the directory so that a relative path to readme.txt can be supplied.\nSet-Location \"$Env:windir\\System32\\Tasks\"\n\nCopy-Item -Path \"$([System.Runtime.InteropServices.RuntimeEnvironment]::GetRuntimeDirectory())InstallUtil.exe\" -Destination \"$Env:windir\\System32\\Tasks\\notepad.exe\"\n\n$TestArgs = @{\n    OutputAssemblyDirectory = $InstallerAssemblyDir\n    OutputAssemblyFileName = $InstallerAssemblyFileName\n    InvocationMethod = 'Executable'\n    CommandLine = $CommandLine\n    InstallUtilPath = \"$Env:windir\\System32\\Tasks\\notepad.exe\"\n}\n\n$ActualOutput = Invoke-BuildAndInvokeInstallUtilAssembly @TestArgs -MinimumViableAssembly\n\nif ($ActualOutput -ne $ExpectedOutput) {\n    throw @\"\nEvasive Installutil invocation test failure. Installer assembly execution output did not match the expected output.\nExpected: $ExpectedOutput\nActual: $ActualOutput\n\"@\n}"
      },
      "input_arguments": [
        {
          "arg_name": "test_harness",
          "description": "location of the test harness script - Invoke-BuildAndInvokeInstallUtilAssembly",
          "type": "path",
          "default": "PathToAtomicsFolder\\T1218.004\\src\\InstallUtilTestHarness.ps1"
        }
      ],
      "dependencies": [
        {
          "description": "InstallUtil test harness script must be installed at specified location (#{test_harness})",
          "prereq_command": "if (Test-Path \"#{test_harness}\") {exit 0} else {exit 1}",
          "get_prereq_command": "New-Item -Type Directory (split-path \"#{test_harness}\") -ErrorAction ignore | Out-Null\nInvoke-WebRequest 'https://github.com/redcanaryco/atomic-red-team/raw/master/atomics/T1218.004/src/InstallUtilTestHarness.ps1' -OutFile \"#{test_harness}\""
        }
      ],
      "auto_generated_guid": "559e6d06-bb42-4307-bff7-3b95a8254bad"
    }
  ]
}