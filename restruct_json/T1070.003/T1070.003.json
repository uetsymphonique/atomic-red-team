{
  "attack_technique": "T1070.003",
  "display_name": "Indicator Removal on Host: Clear Command History",
  "atomic_tests": [
    {
      "name": "Clear Bash history (rm)",
      "description": "Clears bash history via rm",
      "supported_platforms": [
        "linux",
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "procedure": "rm #{history_path}"
      },
      "input_arguments": [
        {
          "arg_name": "history_path",
          "description": "Bash history path",
          "type": "path",
          "default": "~/.bash_history"
        }
      ],
      "auto_generated_guid": "a934276e-2be5-4a36-93fd-98adbb5bd4fc"
    },
    {
      "name": "Clear Bash history (echo)",
      "description": "Clears bash history via echo",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "procedure": "echo \"\" > #{history_path}"
      },
      "input_arguments": [
        {
          "arg_name": "history_path",
          "description": "Bash history path",
          "type": "path",
          "default": "~/.bash_history"
        }
      ],
      "auto_generated_guid": "cbf506a5-dd78-43e5-be7e-a46b7c7a0a11"
    },
    {
      "name": "Clear Bash history (cat dev/null)",
      "description": "Clears bash history via cat /dev/null",
      "supported_platforms": [
        "linux",
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "procedure": "cat /dev/null > #{history_path}"
      },
      "input_arguments": [
        {
          "arg_name": "history_path",
          "description": "Bash history path",
          "type": "path",
          "default": "~/.bash_history"
        }
      ],
      "auto_generated_guid": "b1251c35-dcd3-4ea1-86da-36d27b54f31f"
    },
    {
      "name": "Clear Bash history (ln dev/null)",
      "description": "Clears bash history via a symlink to /dev/null",
      "supported_platforms": [
        "linux",
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "procedure": "ln -sf /dev/null #{history_path}"
      },
      "input_arguments": [
        {
          "arg_name": "history_path",
          "description": "Bash history path",
          "type": "path",
          "default": "~/.bash_history"
        }
      ],
      "auto_generated_guid": "23d348f3-cc5c-4ba9-bd0a-ae09069f0914"
    },
    {
      "name": "Clear Bash history (truncate)",
      "description": "Clears bash history via truncate",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "procedure": "truncate -s0 #{history_path}"
      },
      "input_arguments": [
        {
          "arg_name": "history_path",
          "description": "Bash history path",
          "type": "path",
          "default": "~/.bash_history"
        }
      ],
      "auto_generated_guid": "47966a1d-df4f-4078-af65-db6d9aa20739"
    },
    {
      "name": "Clear history of a bunch of shells",
      "description": "Clears the history of a bunch of different shell types by setting the history size to zero",
      "supported_platforms": [
        "linux",
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "procedure": "unset HISTFILE\nexport HISTFILESIZE=0\nhistory -c"
      },
      "input_arguments": [],
      "auto_generated_guid": "7e6721df-5f08-4370-9255-f06d8a77af4c"
    },
    {
      "name": "Clear and Disable Bash History Logging",
      "description": "Clears the history and disable bash history logging of the current shell and future shell sessions",
      "supported_platforms": [
        "linux",
        "macos"
      ],
      "executor": {
        "name": "bash",
        "elevation_required": false,
        "cleanup_command": "sed -i 's/set +o history//g' ~/.bashrc\n. ~/.bashrc\nset -o history",
        "procedure": "set +o history\necho 'set +o history' >> ~/.bashrc\n. ~/.bashrc\nhistory -c"
      },
      "input_arguments": [],
      "auto_generated_guid": "784e4011-bd1a-4ecd-a63a-8feb278512e6"
    },
    {
      "name": "Use Space Before Command to Avoid Logging to History",
      "description": "Using a space before a command causes the command to not be logged in the Bash History file",
      "supported_platforms": [
        "linux",
        "macos"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "procedure": "hostname\nwhoami"
      },
      "input_arguments": [],
      "auto_generated_guid": "53b03a54-4529-4992-852d-a00b4b7215a6"
    },
    {
      "name": "Disable Bash History Logging with SSH -T",
      "description": "Keeps history clear and stays out of lastlog,wtmp,btmp ssh -T keeps the ssh client from catching a proper TTY, which is what usually gets logged on lastlog",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "sh",
        "elevation_required": false,
        "cleanup_command": "[ \"$(uname)\" = 'FreeBSD' ] && rmuser -y testuser1 || userdel -f testuser1",
        "procedure": "sshpass -p 'pwd101!' ssh testuser1@localhost -T hostname"
      },
      "input_arguments": [],
      "dependencies": [
        {
          "description": "Install sshpass and create user account used for excuting",
          "prereq_command": "$(getent passwd testuser1 >/dev/null) && $(which sshpass >/dev/null)",
          "get_prereq_command": "[ \"$(uname)\" = 'FreeBSD' ] && pw useradd testuser1 -g wheel -s /bin/sh || /usr/sbin/useradd testuser1\n[ \"$(uname)\" = 'FreeBSD' ] && echo 'pwd101!' | pw mod user testuser1 -h 0 || echo -e 'pwd101!\\npwd101!' | passwd testuser1\n(which yum && yum -y install epel-release sshpass)||(which apt-get && DEBIAN_FRONTEND=noninteractive apt-get install -y sshpass)||(which pkg && pkg install -y sshpass)"
        }
      ],
      "auto_generated_guid": "5f8abd62-f615-43c5-b6be-f780f25790a1"
    },
    {
      "name": "Clear Docker Container Logs",
      "description": "Clears Docker container logs using the Docker CLI and the truncate command, removing all log entries.",
      "supported_platforms": [
        "linux"
      ],
      "executor": {
        "name": "bash",
        "elevation_required": true,
        "procedure": "docker container prune -f && sudo truncate -s 0 /var/lib/docker/containers/*/*-json.log"
      },
      "input_arguments": [],
      "auto_generated_guid": "553b39f9-1e8c-47b1-abf5-8daf7b0391e9"
    },
    {
      "name": "Prevent Powershell History Logging",
      "description": "Prevents Powershell history",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "cleanup_command": "Set-PSReadLineOption -HistorySaveStyle SaveIncrementally",
        "procedure": "Set-PSReadlineOption -HistorySaveStyle SaveNothing"
      },
      "input_arguments": [],
      "auto_generated_guid": "2f898b81-3e97-4abb-bc3f-a95138988370"
    },
    {
      "name": "Clear Powershell History by Deleting History File",
      "description": "Clears Powershell history",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "procedure": "Remove-Item (Get-PSReadlineOption).HistorySavePath"
      },
      "input_arguments": [],
      "auto_generated_guid": "da75ae8d-26d6-4483-b0fe-700e4df4f037"
    },
    {
      "name": "Set Custom AddToHistoryHandler to Avoid History File Logging",
      "description": "The \"AddToHistoryHandler\" receives the current command as the $line variable and then returns $true if \nthe line should be written to the history file. Here we simply return $false so nothing gets added to \nthe history file for the current session.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "cleanup_command": "Set-PSReadLineOption -AddToHistoryHandler $null",
        "procedure": "Set-PSReadLineOption -AddToHistoryHandler { return $false }"
      },
      "input_arguments": [],
      "auto_generated_guid": "1d0d9aa6-6111-4f89-927b-53e8afae7f94"
    },
    {
      "name": "Clear PowerShell Session History",
      "description": "This technique involves using the Clear-History cmdlet in PowerShell to remove all records of previously executed commands.\nThis action is often performed by attackers to eliminate traces of their activities, making incident detection and forensic \ninvestigation more challenging. By clearing the session history, adversaries aim to obfuscate their operational footprint.",
      "supported_platforms": [
        "windows"
      ],
      "executor": {
        "name": "powershell",
        "elevation_required": false,
        "procedure": "Clear-History"
      },
      "input_arguments": [],
      "auto_generated_guid": "22c779cd-9445-4d3e-a136-f75adbf0315f"
    }
  ]
}